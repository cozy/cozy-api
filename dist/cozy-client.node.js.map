{"version":3,"sources":["webpack:///webpack/bootstrap b3c9fb0aa6433c31f371","webpack:///external \"isomorphic-fetch\"","webpack:///./src/index.js","webpack:///external \"core-js/modules/es6.object.assign\"","webpack:///./src/utils.js","webpack:///./src/auth_storage.js","webpack:///./src/auth_v2.js","webpack:///external \"btoa\"","webpack:///./src/auth_v3.js","webpack:///./src/fetch.js","webpack:///./src/jsonapi.js","webpack:///external \"crypto\"","webpack:///./src/data.js","webpack:///./src/doctypes.js","webpack:///./src/mango.js","webpack:///./src/files.js","webpack:///./src/intents/index.js","webpack:///external \"babel-runtime/regenerator\"","webpack:///./src/intents/helpers.js","webpack:///./src/intents/client.js","webpack:///./src/intents/service.js","webpack:///./src/jobs.js","webpack:///./src/offline.js","webpack:///external \"pouchdb\"","webpack:///external \"pouchdb-find\"","webpack:///./src/settings.js","webpack:///./src/relations.js"],"names":["auth","data","cozyFetch","mango","files","intents","jobs","offline","settings","relations","AppTokenV3","AppToken","AccessTokenV3","AccessToken","ClientV3","Client","AuthNone","AuthRunning","AuthError","AuthOK","defaultClientParams","softwareID","dataProto","create","find","findMany","findAll","update","delete","_delete","updateAttributes","changesFeed","defineIndex","query","addReferencedFiles","removeReferencedFiles","listReferencedFiles","fetchReferencedFiles","destroy","authProto","client","registerClient","updateClient","unregisterClient","getClient","getAuthCodeURL","getAccessToken","refreshToken","filesProto","createDirectory","createDirectoryByPath","updateById","updateAttributesById","updateAttributesByPath","trashById","statById","statByPath","downloadById","downloadByPath","getDownloadLinkById","getDownloadLink","getDownloadLinkByPath","getArchiveLink","getArchiveLinkByPaths","getArchiveLinkByIds","getFilePath","getCollectionShareLink","queryFiles","listTrash","clearTrash","restoreById","destroyById","intentsProto","createService","getRedirectionURL","redirect","jobsProto","count","queued","offlineProto","init","getDoctypes","hasDatabase","getDatabase","createDatabase","destroyDatabase","destroyAllDatabase","hasReplication","replicateFromCozy","stopReplication","stopAllReplication","hasRepeatedReplication","startRepeatedReplication","stopRepeatedReplication","stopAllRepeatedReplication","settingsProto","diskUsage","changePassphrase","getInstance","updateInstance","getClients","deleteClientById","updateLastSync","ensureHasReconnectParam","url","URL","_url","searchParams","has","append","search","indexOf","toString","options","AppTokenV2","LocalStorage","MemoryStorage","_inited","_oauth","_token","_authstate","_authcreds","_storage","_version","version","_offline","token","oauth","Error","storage","_clientParams","Object","assign","clientParams","_onRegistered","onRegistered","nopOnRegistered","cozyURL","length","slice","_invalidTokenErrorHandler","onInvalidTokenError","undefined","handleInvalidTokenError","disablePromises","addToProto","fetchJSON","_fetchJSON","args","concat","Array","prototype","call","arguments","cozyFetchJSON","apply","forceTokenRefresh","state","isV2","then","redirectURI","oauthFlow","Promise","resolve","creds","save","CredsKey","path","pathprefix","fetch","res","ok","json","status","datasystem","protoify","context","fn","prototyped","ctx","obj","proto","attr","module","exports","unpromiser","isPromise","isOnline","isOffline","sleep","retry","getFuzzedDelay","getBackedoffDelay","createPath","encodeQuery","decodeQuery","warn","FuzzFactor","value","l","cb","err","navigator","onLine","time","setTimeout","delay","doTry","catch","retryDelay","fuzzingFactor","Math","random","retryCount","pow","cozy","doctype","id","route","encodeURIComponent","q","qname","queryIndex","queries","fragIndex","queryStr","parts","split","i","pair","decodeURIComponent","hasOwnProperty","warned","text","push","console","prefix","window","localStorage","key","setItem","JSON","stringify","item","getItem","parse","removeItem","hash","deleted","getAppToken","V2TOKEN_ABORT_TIMEOUT","reject","parent","postMessage","origin","location","intent","action","timeout","receiver","event","appName","e","removeEventListener","clearTimeout","addEventListener","opts","btoa","StateSize","StateKey","clientID","client_id","clientSecret","client_secret","registrationAccessToken","registration_access_token","redirect_uris","software_id","softwareVersion","software_version","clientName","client_name","clientKind","client_kind","clientURI","client_uri","logoURI","logo_uri","policyURI","policy_uri","notificationPlatform","notification_platform","notificationDeviceToken","notification_device_token","tokenType","token_type","accessToken","access_token","refresh_token","scope","cli","isRegistered","toRegisterJSON","disableAuth","resetSecret","manualAuthCredentials","createClient","FetchError","isUnauthorized","isNotFound","oldClient","newClient","shouldPassRegistration","scopes","generateRandomState","redirect_uri","response_type","join","pageURL","grantQueries","getGrantCodeFromPageURL","retrieveToken","grant_type","code","ignoreCachedCredentials","clear","tryCount","clearAndRetry","registerNewClient","all","load","credentials","storedState","statePromise","t","body","dontRetry","headers","href","buffer","crypto","getRandomValues","Uint8Array","require","randomBytes","floor","String","fromCharCode","replace","cozyFetchRawJSON","fullpath","resp","cozyFetchWithAuth","authorize","handleResponse","toAuthHeader","saveCredentials","newToken","method","processJSONAPI","handleJSONResponse","response","invalidTokenErrorHandler","contentType","get","error","isInvalidToken","jsonapi","currentOrigin","requestUrl","redirectURL","disconnect","reason","captureStackTrace","constructor","name","defineProperty","message","indexKey","doc","type","findByRef","resources","ref","handleResource","rawResource","links","resource","_id","_type","_rev","meta","rev","attributes","rels","relationships","isArray","map","handleTopLevel","included","forEach","r","NOREV","docType","httpVerb","ids","include_docs","keys","docs","rows","row","match","changes","tries","normalizeDoctype","DOCTYPE_FILES","KNOWN_DOCTYPES","folder","contact","track","playlist","REVERSE_KNOWN","k","isQualified","known","parseSelector","normalizeSelector","makeMapReduceQuery","fields","defineIndexV2","defineIndexV3","indexRef","queryV2","queryV3","getV3Options","wholeResponse","VALUEOPERATORS","LOGICOPERATORS","MAP_TEMPLATE","toLowerCase","emit","FIELDSPLACEHOLDER","COUCHDB_INFINITY","COUCHDB_LOWEST","indexName","capitalize","indexDefinition","makeMapFunction","reduce","index","indexResult","result","selector","$gt","use_index","limit","skip","since","sort","descending","f","charAt","toUpperCase","operator","acc","filters","filter","op","field","applySelector","lower","upper","inclusiveEnd","startkey","endkey","inclusive_end","mrquery","firstFreeValueField","normalizedSelector","used","isFreeValue","ROOT_DIR_ID","TRASH_DIR_ID","contentTypeOctetStream","sanitizeFileName","trim","getFileTypeFromName","test","doUpload","ArrayBuffer","isBuffer","isFile","File","isBlob","Blob","isStream","readable","pipe","isString","contentLength","checksum","lastModifiedDate","ifMatch","Date","toGMTString","dirID","executable","getDirectoryOrCreate","parentDirectory","parsedError","errors","part","rootDirectoryPromise","parentDirectoryPromise","doUpdateAttributes","attrs","db","dir_id","children","sortFiles","addIsDir","toJsonApi","encodePageOptions","extractResponseLinkRelated","related","file","folderPath","endsWith","collectionType","permissions","verbs","values","collection","sharecode","codes","email","paths","archive","isDir","contents","clone","allFiles","folders","a","b","localeCompare","service","baseURL","sanitizedURL","buildRedirectionURL","redirectionURL","createPromise","start","element","onReadyCallback","filteredServices","intentId","serviceWindow","isSerializable","includes","parameterStrings","pickService","errorSerializer","mapErrorProperties","from","to","nativeProperties","property","serialize","deserialize","first","arr","filterServices","services","intentClass","hideIntentIframe","iframe","style","display","showIntentFrame","buildIntentIframe","document","ownerDocument","createElement","setAttribute","classList","add","injectIntentIframe","onload","appendChild","focus","connectIntentIframe","exposeIntentFrameRemoval","compose","defaultView","serviceOrigin","src","handshaken","messageHandler","eventType","source","transition","dimensions","prop","removeIntentFrame","parentNode","removeChild","listenClientData","messageEventListener","maximize","height","documentElement","terminated","sendMessage","composeEventListener","terminate","resizeClient","transitionProperty","maxHeight","clientHeight","maxWidth","clientWidth","cancel","getData","getIntent","eventName","throw","workerType","setDatabase","replicationOfflineError","pluginLoaded","doctypes","getInfo","database","PouchDB","plugin","pouchdbFind","pouchdbAdapterCordovaSqlite","createIndexes","createIndex","getReplication","replication","setReplication","getReplicationUrl","basic","toBasicAuth","getReplicationPromise","replicationPromise","setReplicationPromise","promise","live","onError","replicate","on","info","onComplete","stop","getRepeatedReplication","interval","setRepeatedReplication","timer","setInterval","clearInterval","currentPassPhrase","newPassPhrase","current_passphrase","new_passphrase","instance","updateRelations","verb","refs","makeReferencesPath","params"],"mappings":"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","file":"cozy-client.node.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b3c9fb0aa6433c31f371","module.exports = require(\"isomorphic-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-fetch\"\n// module id = 1\n// module chunks = 0","/* global fetch URL */\nimport 'core-js/modules/es6.object.assign'\nimport { unpromiser, retry, warn } from './utils'\nimport { LocalStorage, MemoryStorage } from './auth_storage'\nimport { AppToken as AppTokenV2, getAppToken as getAppTokenV2 } from './auth_v2'\nimport * as auth from './auth_v3'\nimport * as data from './data'\nimport * as cozyFetch from './fetch'\nimport * as mango from './mango'\nimport * as files from './files'\nimport * as intents from './intents/'\nimport * as jobs from './jobs'\nimport * as offline from './offline'\nimport * as settings from './settings'\nimport * as relations from './relations'\n\nconst {\n  AppToken: AppTokenV3,\n  AccessToken: AccessTokenV3,\n  Client: ClientV3\n} = auth\n\nconst AuthNone = 0\nconst AuthRunning = 1\nconst AuthError = 2\nconst AuthOK = 3\n\nconst defaultClientParams = {\n  softwareID: 'github.com/cozy/cozy-client-js'\n}\n\nconst dataProto = {\n  create: data.create,\n  find: data.find,\n  findMany: data.findMany,\n  findAll: data.findAll,\n  update: data.update,\n  delete: data._delete,\n  updateAttributes: data.updateAttributes,\n  changesFeed: data.changesFeed,\n  defineIndex: mango.defineIndex,\n  query: mango.query,\n  addReferencedFiles: relations.addReferencedFiles,\n  removeReferencedFiles: relations.removeReferencedFiles,\n  listReferencedFiles: relations.listReferencedFiles,\n  fetchReferencedFiles: relations.fetchReferencedFiles,\n  destroy: function(...args) {\n    warn('destroy is deprecated, use cozy.data.delete instead.')\n    return data._delete(...args)\n  }\n}\n\nconst authProto = {\n  client: auth.client,\n  registerClient: auth.registerClient,\n  updateClient: auth.updateClient,\n  unregisterClient: auth.unregisterClient,\n  getClient: auth.getClient,\n  getAuthCodeURL: auth.getAuthCodeURL,\n  getAccessToken: auth.getAccessToken,\n  refreshToken: auth.refreshToken\n}\n\nconst filesProto = {\n  create: files.create,\n  createDirectory: files.createDirectory,\n  createDirectoryByPath: files.createDirectoryByPath,\n  updateById: files.updateById,\n  updateAttributesById: files.updateAttributesById,\n  updateAttributesByPath: files.updateAttributesByPath,\n  trashById: files.trashById,\n  statById: files.statById,\n  statByPath: files.statByPath,\n  downloadById: files.downloadById,\n  downloadByPath: files.downloadByPath,\n  getDownloadLinkById: files.getDownloadLinkById,\n  getDownloadLink: files.getDownloadLinkByPath, // DEPRECATED, should be removed very soon\n  getDownloadLinkByPath: files.getDownloadLinkByPath,\n  getArchiveLink: function(...args) {\n    warn(\n      'getArchiveLink is deprecated, use cozy.files.getArchiveLinkByPaths instead.'\n    )\n    return files.getArchiveLinkByPaths(...args)\n  },\n  getArchiveLinkByPaths: files.getArchiveLinkByPaths,\n  getArchiveLinkByIds: files.getArchiveLinkByIds,\n  getFilePath: files.getFilePath,\n  getCollectionShareLink: files.getCollectionShareLink,\n  query: mango.queryFiles,\n  listTrash: files.listTrash,\n  clearTrash: files.clearTrash,\n  restoreById: files.restoreById,\n  destroyById: files.destroyById\n}\n\nconst intentsProto = {\n  create: intents.create,\n  createService: intents.createService,\n  getRedirectionURL: intents.getRedirectionURL,\n  redirect: intents.redirect\n}\n\nconst jobsProto = {\n  create: jobs.create,\n  count: jobs.count,\n  queued: jobs.queued\n}\n\nconst offlineProto = {\n  init: offline.init,\n  getDoctypes: offline.getDoctypes,\n  // database\n  hasDatabase: offline.hasDatabase,\n  getDatabase: offline.getDatabase,\n  createDatabase: offline.createDatabase,\n  destroyDatabase: offline.destroyDatabase,\n  destroyAllDatabase: offline.destroyAllDatabase,\n  // replication\n  hasReplication: offline.hasReplication,\n  replicateFromCozy: offline.replicateFromCozy,\n  stopReplication: offline.stopReplication,\n  stopAllReplication: offline.stopAllReplication,\n  // repeated replication\n  hasRepeatedReplication: offline.hasRepeatedReplication,\n  startRepeatedReplication: offline.startRepeatedReplication,\n  stopRepeatedReplication: offline.stopRepeatedReplication,\n  stopAllRepeatedReplication: offline.stopAllRepeatedReplication\n}\n\nconst settingsProto = {\n  diskUsage: settings.diskUsage,\n  changePassphrase: settings.changePassphrase,\n  getInstance: settings.getInstance,\n  updateInstance: settings.updateInstance,\n  getClients: settings.getClients,\n  deleteClientById: settings.deleteClientById,\n  updateLastSync: settings.updateLastSync\n}\n\nconst ensureHasReconnectParam = _url => {\n  const url = new URL(_url)\n  if (url.searchParams && !url.searchParams.has('reconnect')) {\n    url.searchParams.append('reconnect', 1)\n  } else if (!url.search || url.search.indexOf('reconnect') === -1) {\n    // Some old navigators do not have the searchParams API\n    // and it is not polyfilled by babel-polyfill\n    url.search = url.search + '&reconnect=1'\n  }\n  return url.toString()\n}\n\nclass Client {\n  constructor(options) {\n    this.data = {}\n    this.files = {}\n    this.intents = {}\n    this.jobs = {}\n    this.offline = {}\n    this.settings = {}\n    this.auth = {\n      Client: ClientV3,\n      AccessToken: AccessTokenV3,\n      AppToken: AppTokenV3,\n      AppTokenV2: AppTokenV2,\n      LocalStorage: LocalStorage,\n      MemoryStorage: MemoryStorage\n    }\n    this._inited = false\n    if (options) {\n      this.init(options)\n    }\n  }\n\n  init(options = {}) {\n    this._inited = true\n    this._oauth = false // is oauth activated or not\n    this._token = null // application token\n    this._authstate = AuthNone\n    this._authcreds = null\n    this._storage = null\n    this._version = options.version || null\n    this._offline = null\n\n    const token = options.token\n    const oauth = options.oauth\n    if (token && oauth) {\n      throw new Error(\n        'Cannot specify an application token with a oauth activated'\n      )\n    }\n\n    if (token) {\n      this._token = new AppTokenV3({ token })\n    } else if (oauth) {\n      this._oauth = true\n      this._storage = oauth.storage\n      this._clientParams = Object.assign(\n        {},\n        defaultClientParams,\n        oauth.clientParams\n      )\n      this._onRegistered = oauth.onRegistered || nopOnRegistered\n    }\n\n    let url = options.cozyURL || ''\n    while (url[url.length - 1] === '/') {\n      url = url.slice(0, -1)\n    }\n\n    this._url = url\n\n    this._invalidTokenErrorHandler =\n      options.onInvalidTokenError !== undefined\n        ? options.onInvalidTokenError\n        : cozyFetch.handleInvalidTokenError\n\n    const disablePromises = !!options.disablePromises\n    addToProto(this, this.data, dataProto, disablePromises)\n    addToProto(this, this.auth, authProto, disablePromises)\n    addToProto(this, this.files, filesProto, disablePromises)\n    addToProto(this, this.intents, intentsProto, disablePromises)\n    addToProto(this, this.jobs, jobsProto, disablePromises)\n    addToProto(this, this.offline, offlineProto, disablePromises)\n    addToProto(this, this.settings, settingsProto, disablePromises)\n\n    if (options.offline) {\n      this.offline.init(options.offline)\n    }\n\n    // Exposing cozyFetchJSON to make some development easier. Should be temporary.\n    this.fetchJSON = function _fetchJSON() {\n      const args = [this].concat(Array.prototype.slice.call(arguments))\n      return cozyFetch.cozyFetchJSON.apply(this, args)\n    }\n  }\n\n  authorize(forceTokenRefresh = false) {\n    const state = this._authstate\n    if (state === AuthOK || state === AuthRunning) {\n      return this._authcreds\n    }\n\n    this._authstate = AuthRunning\n    this._authcreds = this.isV2().then(isV2 => {\n      if (isV2 && this._oauth) {\n        throw new Error('OAuth is not supported on the V2 stack')\n      }\n      if (this._oauth) {\n        if (forceTokenRefresh && this._clientParams.redirectURI) {\n          this._clientParams.redirectURI = ensureHasReconnectParam(\n            this._clientParams.redirectURI\n          )\n        }\n        return auth.oauthFlow(\n          this,\n          this._storage,\n          this._clientParams,\n          this._onRegistered,\n          forceTokenRefresh\n        )\n      }\n      // we expect to be on a client side application running in a browser\n      // with cookie-based authentication.\n      if (isV2) {\n        return getAppTokenV2()\n      } else if (this._token) {\n        return Promise.resolve({ client: null, token: this._token })\n      } else {\n        throw new Error('Missing application token')\n      }\n    })\n\n    this._authcreds.then(\n      () => {\n        this._authstate = AuthOK\n      },\n      () => {\n        this._authstate = AuthError\n      }\n    )\n\n    return this._authcreds\n  }\n\n  saveCredentials(client, token) {\n    const creds = { client, token }\n    if (!this._storage || this._authstate === AuthRunning) {\n      return Promise.resolve(creds)\n    }\n    this._storage.save(auth.CredsKey, creds)\n    this._authcreds = Promise.resolve(creds)\n    return this._authcreds\n  }\n\n  fullpath(path) {\n    return this.isV2().then(isV2 => {\n      const pathprefix = isV2 ? '/ds-api' : ''\n      return this._url + pathprefix + path\n    })\n  }\n\n  isV2() {\n    if (!this._version) {\n      return retry(() => fetch(`${this._url}/status/`), 3)()\n        .then(res => {\n          if (!res.ok) {\n            throw new Error('Could not fetch cozy status')\n          } else {\n            return res.json()\n          }\n        })\n        .then(status => {\n          this._version = status.datasystem !== undefined ? 2 : 3\n          return this.isV2()\n        })\n    }\n    return Promise.resolve(this._version === 2)\n  }\n}\n\nfunction nopOnRegistered() {\n  throw new Error('Missing onRegistered callback')\n}\n\nfunction protoify(context, fn) {\n  return function prototyped(...args) {\n    return fn(context, ...args)\n  }\n}\n\nfunction addToProto(ctx, obj, proto, disablePromises) {\n  for (const attr in proto) {\n    let fn = protoify(ctx, proto[attr])\n    if (disablePromises) {\n      fn = unpromiser(fn)\n    }\n    obj[attr] = fn\n  }\n}\n\nmodule.exports = new Client()\nObject.assign(module.exports, { Client, LocalStorage, MemoryStorage })\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"core-js/modules/es6.object.assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"core-js/modules/es6.object.assign\"\n// module id = 3\n// module chunks = 0","/* global navigator */\nconst FuzzFactor = 0.3\n\nexport function unpromiser(fn) {\n  return function(...args) {\n    const value = fn.apply(this, args)\n    if (!isPromise(value)) {\n      return value\n    }\n    const l = args.length\n    if (l === 0 || typeof args[l - 1] !== 'function') {\n      return\n    }\n    const cb = args[l - 1]\n    value.then(res => cb(null, res), err => cb(err, null))\n  }\n}\n\nexport function isPromise(value) {\n  return !!value && typeof value.then === 'function'\n}\n\nexport function isOnline() {\n  return typeof navigator !== 'undefined' ? navigator.onLine : true\n}\n\nexport function isOffline() {\n  return !isOnline()\n}\n\nexport function sleep(time, args) {\n  return new Promise(resolve => {\n    setTimeout(resolve, time, args)\n  })\n}\n\nexport function retry(fn, count, delay = 300) {\n  return function doTry(...args) {\n    return fn(...args).catch(err => {\n      if (--count < 0) {\n        throw err\n      }\n      return sleep(getBackedoffDelay(delay, count)).then(() => doTry(...args))\n    })\n  }\n}\n\nexport function getFuzzedDelay(retryDelay) {\n  const fuzzingFactor = (Math.random() * 2 - 1) * FuzzFactor\n  return retryDelay * (1.0 + fuzzingFactor)\n}\n\nexport function getBackedoffDelay(retryDelay, retryCount = 1) {\n  return getFuzzedDelay(retryDelay * Math.pow(2, retryCount - 1))\n}\n\nexport function createPath(cozy, isV2, doctype, id = '', query = null) {\n  let route = '/data/'\n  if (!isV2) {\n    route += `${encodeURIComponent(doctype)}/`\n  }\n  if (id !== '') {\n    route += encodeURIComponent(id)\n  }\n  const q = encodeQuery(query)\n  if (q !== '') {\n    route += '?' + q\n  }\n  return route\n}\n\nexport function encodeQuery(query) {\n  if (!query) {\n    return ''\n  }\n  let q = ''\n  for (const qname in query) {\n    if (q !== '') {\n      q += '&'\n    }\n    q += `${encodeURIComponent(qname)}=${encodeURIComponent(query[qname])}`\n  }\n  return q\n}\n\nexport function decodeQuery(url) {\n  let queryIndex = url.indexOf('?')\n  if (queryIndex < 0) {\n    queryIndex = url.length\n  }\n  const queries = {}\n  let fragIndex = url.indexOf('#')\n  if (fragIndex < 0) {\n    fragIndex = url.length\n  }\n  if (fragIndex < queryIndex) {\n    return queries\n  }\n  const queryStr = url.slice(queryIndex + 1, fragIndex)\n  if (queryStr === '') {\n    return queries\n  }\n  const parts = queryStr.split('&')\n  for (let i = 0; i < parts.length; i++) {\n    let pair = parts[i].split('=')\n    if (pair.length === 0 || pair[0] === '') {\n      continue\n    }\n    const qname = decodeURIComponent(pair[0])\n    if (queries.hasOwnProperty(qname)) {\n      continue\n    }\n    if (pair.length === 1) {\n      queries[qname] = true\n    } else if (pair.length === 2) {\n      queries[qname] = decodeURIComponent(pair[1])\n    } else {\n      throw new Error('Malformed URL')\n    }\n  }\n  return queries\n}\n\nconst warned = []\nexport function warn(text) {\n  if (warned.indexOf(text) === -1) {\n    warned.push(text)\n    console.warn('cozy-client-js', text)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","export class LocalStorage {\n  constructor(storage, prefix) {\n    if (!storage && typeof window !== 'undefined') {\n      storage = window.localStorage\n    }\n    this.storage = storage\n    this.prefix = prefix || 'cozy:oauth:'\n  }\n\n  save(key, value) {\n    return new Promise(resolve => {\n      this.storage.setItem(this.prefix + key, JSON.stringify(value))\n      resolve(value)\n    })\n  }\n\n  load(key) {\n    return new Promise(resolve => {\n      const item = this.storage.getItem(this.prefix + key)\n      if (!item) {\n        resolve()\n      } else {\n        resolve(JSON.parse(item))\n      }\n    })\n  }\n\n  delete(key) {\n    return new Promise(resolve =>\n      resolve(this.storage.removeItem(this.prefix + key))\n    )\n  }\n\n  clear() {\n    return new Promise(resolve => {\n      const storage = this.storage\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i)\n        if (key.indexOf(this.prefix) === 0) {\n          storage.removeItem(key)\n        }\n      }\n      resolve()\n    })\n  }\n}\n\nexport class MemoryStorage {\n  constructor() {\n    this.hash = Object.create(null)\n  }\n\n  save(key, value) {\n    this.hash[key] = value\n    return Promise.resolve(value)\n  }\n\n  load(key) {\n    return Promise.resolve(this.hash[key])\n  }\n\n  delete(key) {\n    const deleted = delete this.hash[key]\n    return Promise.resolve(deleted)\n  }\n\n  clear() {\n    this.hash = Object.create(null)\n    return Promise.resolve()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_storage.js","/* global btoa */\nconst V2TOKEN_ABORT_TIMEOUT = 3000\n\nexport function getAppToken() {\n  return new Promise(function(resolve, reject) {\n    if (typeof window === 'undefined') {\n      return reject(new Error('getV2Token should be used in browser'))\n    } else if (!window.parent) {\n      return reject(new Error('getV2Token should be used in iframe'))\n    } else if (!window.parent.postMessage) {\n      return reject(new Error('getV2Token should be used in modern browser'))\n    }\n    const origin = window.location.origin\n    const intent = { action: 'getToken' }\n    let timeout = null\n    const receiver = function(event) {\n      let token\n      try {\n        token = new AppToken({\n          appName: event.data.appName,\n          token: event.data.token\n        })\n      } catch (e) {\n        reject(e)\n        return\n      }\n      window.removeEventListener('message', receiver)\n      clearTimeout(timeout)\n      resolve({ client: null, token })\n    }\n    window.addEventListener('message', receiver, false)\n    window.parent.postMessage(intent, origin)\n    timeout = setTimeout(() => {\n      reject(new Error('No response from parent iframe after 3s'))\n    }, V2TOKEN_ABORT_TIMEOUT)\n  })\n}\n\nexport class AppToken {\n  constructor(opts) {\n    this.appName = opts.appName || ''\n    this.token = opts.token || ''\n  }\n\n  toAuthHeader() {\n    return 'Basic ' + btoa(`${this.appName}:${this.token}`)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_v2.js","module.exports = require(\"btoa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"btoa\"\n// module id = 7\n// module chunks = 0","/* global btoa */\nimport { encodeQuery, decodeQuery, isOffline } from './utils'\nimport { cozyFetchJSON, FetchError } from './fetch'\n\nconst StateSize = 16\n\nexport const CredsKey = 'creds'\nexport const StateKey = 'state'\n\nexport class Client {\n  constructor(opts) {\n    this.clientID = opts.clientID || opts.client_id || ''\n    this.clientSecret = opts.clientSecret || opts.client_secret || ''\n    this.registrationAccessToken =\n      opts.registrationAccessToken || opts.registration_access_token || ''\n\n    if (opts.redirect_uris) {\n      this.redirectURI = opts.redirect_uris[0] || ''\n    } else {\n      this.redirectURI = opts.redirectURI || ''\n    }\n\n    this.softwareID = opts.softwareID || opts.software_id || ''\n    this.softwareVersion = opts.softwareVersion || opts.software_version || ''\n    this.clientName = opts.clientName || opts.client_name || ''\n    this.clientKind = opts.clientKind || opts.client_kind || ''\n    this.clientURI = opts.clientURI || opts.client_uri || ''\n\n    this.logoURI = opts.logoURI || opts.logo_uri || ''\n    this.policyURI = opts.policyURI || opts.policy_uri || ''\n\n    this.notificationPlatform =\n      opts.notificationPlatform || opts.notification_platform || ''\n    this.notificationDeviceToken =\n      opts.notificationDeviceToken || opts.notification_device_token || ''\n\n    if (!this.registrationAccessToken) {\n      if (this.redirectURI === '') {\n        throw new Error('Missing redirectURI field')\n      }\n      if (this.softwareID === '') {\n        throw new Error('Missing softwareID field')\n      }\n      if (this.clientName === '') {\n        throw new Error('Missing clientName field')\n      }\n    }\n  }\n\n  isRegistered() {\n    return this.clientID !== ''\n  }\n\n  toRegisterJSON() {\n    return {\n      redirect_uris: [this.redirectURI],\n      software_id: this.softwareID,\n      software_version: this.softwareVersion,\n      client_name: this.clientName,\n      client_kind: this.clientKind,\n      client_uri: this.clientURI,\n      logo_uri: this.logoURI,\n      policy_uri: this.policyURI,\n      notification_platform: this.notificationPlatform,\n      notification_device_token: this.notificationDeviceToken\n    }\n  }\n\n  toAuthHeader() {\n    return 'Bearer ' + this.registrationAccessToken\n  }\n}\n\nexport class AccessToken {\n  constructor(opts) {\n    this.tokenType = opts.tokenType || opts.token_type\n    this.accessToken = opts.accessToken || opts.access_token\n    this.refreshToken = opts.refreshToken || opts.refresh_token\n    this.scope = opts.scope\n  }\n\n  toAuthHeader() {\n    return 'Bearer ' + this.accessToken\n  }\n\n  toBasicAuth() {\n    return `user:${this.accessToken}@`\n  }\n}\n\nexport class AppToken {\n  constructor(opts) {\n    this.token = opts.token || ''\n  }\n\n  toAuthHeader() {\n    return 'Bearer ' + this.token\n  }\n\n  toBasicAuth() {\n    return `user:${this.token}@`\n  }\n}\n\nexport function client(cozy, clientParams) {\n  if (!clientParams) {\n    clientParams = cozy._clientParams\n  }\n  if (clientParams instanceof Client) {\n    return clientParams\n  }\n  return new Client(clientParams)\n}\n\nexport function registerClient(cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (cli.isRegistered()) {\n    return Promise.reject(new Error('Client already registered'))\n  }\n  return cozyFetchJSON(cozy, 'POST', '/auth/register', cli.toRegisterJSON(), {\n    disableAuth: true\n  }).then(data => new Client(data))\n}\n\nexport function updateClient(cozy, clientParams, resetSecret = false) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  let data = cli.toRegisterJSON()\n  data.client_id = cli.clientID\n  if (resetSecret) data.client_secret = cli.clientSecret\n\n  return cozyFetchJSON(cozy, 'PUT', `/auth/register/${cli.clientID}`, data, {\n    manualAuthCredentials: {\n      token: cli\n    }\n  }).then(data => createClient(data, cli))\n}\n\nexport function unregisterClient(cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  return cozyFetchJSON(cozy, 'DELETE', `/auth/register/${cli.clientID}`, null, {\n    manualAuthCredentials: {\n      token: cli\n    }\n  })\n}\n\n// getClient will retrive the registered client informations from the server.\nexport function getClient(cozy, clientParams) {\n  const cli = client(cozy, clientParams)\n  if (!cli.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  if (isOffline()) {\n    return Promise.resolve(cli)\n  }\n  return cozyFetchJSON(cozy, 'GET', `/auth/register/${cli.clientID}`, null, {\n    manualAuthCredentials: {\n      token: cli\n    }\n  })\n    .then(data => createClient(data, cli))\n    .catch(err => {\n      // If we fall into an error while fetching the client (because of a\n      // bad connectivity for instance), we do not bail the whole process\n      // since the client should be able to continue with the persisted\n      // client and token.\n      //\n      // If it is an explicit Unauthorized error though, we bail, clear th\n      // cache and retry.\n      if (FetchError.isUnauthorized(err) || FetchError.isNotFound(err)) {\n        throw new Error('Client has been revoked')\n      }\n      throw err\n    })\n}\n\n// createClient returns a new Client instance given on object containing the\n// data of the client, from the API, and an old instance of the client.\nfunction createClient(data, oldClient) {\n  const newClient = new Client(data)\n  // we need to keep track of the registrationAccessToken since it is send\n  // only on registration. The GET /auth/register/:client-id endpoint does\n  // not return this token.\n  const shouldPassRegistration =\n    !!oldClient &&\n    oldClient.registrationAccessToken !== '' &&\n    newClient.registrationAccessToken === ''\n  if (shouldPassRegistration) {\n    newClient.registrationAccessToken = oldClient.registrationAccessToken\n  }\n  return newClient\n}\n\n// getAuthCodeURL returns a pair {authURL,state} given a registered client. The\n// state should be stored in order to be checked against on the user validation\n// phase.\nexport function getAuthCodeURL(cozy, client, scopes = []) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    throw new Error('Client not registered')\n  }\n  const state = generateRandomState()\n  const query = {\n    client_id: client.clientID,\n    redirect_uri: client.redirectURI,\n    state: state,\n    response_type: 'code',\n    scope: scopes.join(' ')\n  }\n  return {\n    url: cozy._url + `/auth/authorize?${encodeQuery(query)}`,\n    state: state\n  }\n}\n\n// getAccessToken perform a request on the access_token entrypoint with the\n// authorization_code grant type in order to generate a new access token for a\n// newly registered client.\n//\n// This method extracts the access code and state from the given URL. By\n// default it uses window.location.href. Also, it checks the given state with\n// the one specified in the URL query parameter to prevent CSRF attacks.\nexport function getAccessToken(cozy, client, state, pageURL = '') {\n  if (!state) {\n    return Promise.reject(new Error('Missing state value'))\n  }\n  const grantQueries = getGrantCodeFromPageURL(pageURL)\n  if (grantQueries === null) {\n    return Promise.reject(new Error('Missing states from current URL'))\n  }\n  if (state !== grantQueries.state) {\n    return Promise.reject(\n      new Error('Given state does not match url query state')\n    )\n  }\n  return retrieveToken(cozy, client, null, {\n    grant_type: 'authorization_code',\n    code: grantQueries.code\n  })\n}\n\n// refreshToken perform a request on the access_token entrypoint with the\n// refresh_token grant type in order to refresh the given token.\nexport function refreshToken(cozy, client, token) {\n  return retrieveToken(cozy, client, token, {\n    grant_type: 'refresh_token',\n    refresh_token: token.refreshToken\n  })\n}\n\n// oauthFlow performs the stateful registration and access granting of an OAuth\n// client.\nexport function oauthFlow(\n  cozy,\n  storage,\n  clientParams,\n  onRegistered,\n  ignoreCachedCredentials = false\n) {\n  if (ignoreCachedCredentials) {\n    return storage\n      .clear()\n      .then(() => oauthFlow(cozy, storage, clientParams, onRegistered, false))\n  }\n\n  let tryCount = 0\n\n  function clearAndRetry(err) {\n    if (tryCount++ > 0) {\n      throw err\n    }\n    return storage\n      .clear()\n      .then(() => oauthFlow(cozy, storage, clientParams, onRegistered))\n  }\n\n  function registerNewClient() {\n    return storage\n      .clear()\n      .then(() => registerClient(cozy, clientParams))\n      .then(client => {\n        const { url, state } = getAuthCodeURL(cozy, client, clientParams.scopes)\n        return storage.save(StateKey, { client, url, state })\n      })\n  }\n\n  return Promise.all([storage.load(CredsKey), storage.load(StateKey)])\n    .then(([credentials, storedState]) => {\n      // If credentials are cached we re-fetch the registered client with the\n      // said token. Fetching the client, if the token is outdated we should try\n      // the token is refreshed.\n      if (credentials) {\n        let oldClient, token\n        try {\n          oldClient = new Client(credentials.client)\n          token = new AccessToken(credentials.token)\n        } catch (err) {\n          // bad cache, we should clear and retry the process\n          return clearAndRetry(err)\n        }\n        return getClient(cozy, oldClient)\n          .then(client => ({ client, token }))\n          .catch(err => {\n            // If we fall into an error while fetching the client (because of a\n            // bad connectivity for instance), we do not bail the whole process\n            // since the client should be able to continue with the persisted\n            // client and token.\n            //\n            // If it is an explicit Unauthorized error though, we bail, clear th\n            // cache and retry.\n            if (FetchError.isUnauthorized(err) || FetchError.isNotFound(err)) {\n              throw new Error('Client has been revoked')\n            }\n            return { client: oldClient, token }\n          })\n      }\n\n      // Otherwise register a new client if necessary (ie. no client is stored)\n      // and call the onRegistered callback to wait for the user to grant the\n      // access. Finally fetches to access token on success.\n      let statePromise\n      if (!storedState) {\n        statePromise = registerNewClient()\n      } else {\n        statePromise = Promise.resolve(storedState)\n      }\n\n      let client, state, token\n      return statePromise\n        .then(data => {\n          client = data.client\n          state = data.state\n          return Promise.resolve(onRegistered(client, data.url))\n        })\n        .then(pageURL => getAccessToken(cozy, client, state, pageURL))\n        .then(t => {\n          token = t\n        })\n        .then(() => storage.delete(StateKey))\n        .then(() => ({ client, token }))\n    })\n    .then(\n      creds => storage.save(CredsKey, creds),\n      err => {\n        if (FetchError.isUnauthorized(err)) {\n          return clearAndRetry(err)\n        } else {\n          throw err\n        }\n      }\n    )\n}\n\n// retrieveToken perform a request on the access_token entrypoint in order to\n// fetch a token.\nfunction retrieveToken(cozy, client, token, query) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  const body = encodeQuery(\n    Object.assign({}, query, {\n      client_id: client.clientID,\n      client_secret: client.clientSecret\n    })\n  )\n  return cozyFetchJSON(cozy, 'POST', '/auth/access_token', body, {\n    disableAuth: token === null,\n    dontRetry: true,\n    manualAuthCredentials: { client, token },\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\n  }).then(data => {\n    data.refreshToken = data.refreshToken || query.refresh_token\n    return new AccessToken(data)\n  })\n}\n\n// getGrantCodeFromPageURL extract the state and access_code query parameters\n// from the given url\nfunction getGrantCodeFromPageURL(pageURL = '') {\n  if (pageURL === '' && typeof window !== 'undefined') {\n    pageURL = window.location.href\n  }\n  const queries = decodeQuery(pageURL)\n  if (!queries.hasOwnProperty('state')) {\n    return null\n  }\n  return {\n    state: queries['state'],\n    code: queries['access_code']\n  }\n}\n\n// generateRandomState will try to generate a 128bits random value from a secure\n// pseudo random generator. It will fallback on Math.random if it cannot find\n// such generator.\nfunction generateRandomState() {\n  let buffer\n  if (\n    typeof window !== 'undefined' &&\n    typeof window.crypto !== 'undefined' &&\n    typeof window.crypto.getRandomValues === 'function'\n  ) {\n    buffer = new Uint8Array(StateSize)\n    window.crypto.getRandomValues(buffer)\n  } else {\n    try {\n      buffer = require('crypto').randomBytes(StateSize)\n    } catch (e) {\n      buffer = null\n    }\n  }\n  if (!buffer) {\n    buffer = new Array(StateSize)\n    for (let i = 0; i < buffer.length; i++) {\n      buffer[i] = Math.floor(Math.random() * 255)\n    }\n  }\n  return btoa(String.fromCharCode.apply(null, buffer))\n    .replace(/=+$/, '')\n    .replace(/\\//g, '_')\n    .replace(/\\+/g, '-')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_v3.js","/* global fetch */\nimport { refreshToken, AccessToken } from './auth_v3'\nimport { retry, encodeQuery } from './utils'\nimport jsonapi from './jsonapi'\n\nexport function cozyFetch(cozy, path, options = {}) {\n  return cozy.fullpath(path).then(fullpath => {\n    let resp\n    if (options.disableAuth) {\n      resp = fetch(fullpath, options)\n    } else if (options.manualAuthCredentials) {\n      resp = cozyFetchWithAuth(\n        cozy,\n        fullpath,\n        options,\n        options.manualAuthCredentials\n      )\n    } else {\n      resp = cozy\n        .authorize()\n        .then(credentials =>\n          cozyFetchWithAuth(cozy, fullpath, options, credentials)\n        )\n    }\n    return resp.then(res => handleResponse(res, cozy._invalidTokenErrorHandler))\n  })\n}\n\nfunction cozyFetchWithAuth(cozy, fullpath, options, credentials) {\n  if (credentials) {\n    options.headers = options.headers || {}\n    options.headers['Authorization'] = credentials.token.toAuthHeader()\n  }\n\n  // the option credentials:include tells fetch to include the cookies in the\n  // request even for cross-origin requests\n  options.credentials = 'include'\n\n  return Promise.all([cozy.isV2(), fetch(fullpath, options)]).then(\n    ([isV2, res]) => {\n      if (\n        (res.status !== 400 && res.status !== 401) ||\n        isV2 ||\n        !credentials ||\n        options.dontRetry\n      ) {\n        return res\n      }\n      // we try to refresh the token only for OAuth, ie, the client defined\n      // and the token is an instance of AccessToken.\n      const { client, token } = credentials\n      if (!client || !(token instanceof AccessToken)) {\n        return res\n      }\n      options.dontRetry = true\n      return retry(() => refreshToken(cozy, client, token), 3)()\n        .then(newToken => cozy.saveCredentials(client, newToken))\n        .then(credentials =>\n          cozyFetchWithAuth(cozy, fullpath, options, credentials)\n        )\n    }\n  )\n}\n\nexport function cozyFetchJSON(cozy, method, path, body, options = {}) {\n  const processJSONAPI =\n    typeof options.processJSONAPI === 'undefined' || options.processJSONAPI\n  return fetchJSON(cozy, method, path, body, options).then(response =>\n    handleJSONResponse(response, processJSONAPI)\n  )\n}\n\nexport function cozyFetchRawJSON(cozy, method, path, body, options = {}) {\n  return fetchJSON(cozy, method, path, body, options).then(response =>\n    handleJSONResponse(response, false)\n  )\n}\n\nfunction fetchJSON(cozy, method, path, body, options = {}) {\n  options.method = method\n\n  const headers = (options.headers = options.headers || {})\n\n  headers['Accept'] = 'application/json'\n\n  if (method !== 'GET' && method !== 'HEAD' && body !== undefined) {\n    if (headers['Content-Type']) {\n      options.body = body\n    } else {\n      headers['Content-Type'] = 'application/json'\n      options.body = JSON.stringify(body)\n    }\n  }\n\n  return cozyFetch(cozy, path, options)\n}\n\nfunction handleResponse(res, invalidTokenErrorHandler) {\n  if (res.ok) {\n    return res\n  }\n  let data\n  const contentType = res.headers.get('content-type')\n  if (contentType && contentType.indexOf('json') >= 0) {\n    data = res.json()\n  } else {\n    data = res.text()\n  }\n  return data.then(err => {\n    const error = new FetchError(res, err)\n    if (FetchError.isInvalidToken(error) && invalidTokenErrorHandler) {\n      invalidTokenErrorHandler(error)\n    }\n    throw error\n  })\n}\n\nfunction handleJSONResponse(res, processJSONAPI = true) {\n  const contentType = res.headers.get('content-type')\n  if (!contentType || contentType.indexOf('json') < 0) {\n    return res.text(data => {\n      throw new FetchError(res, new Error('Response is not JSON: ' + data))\n    })\n  }\n\n  const json = res.json()\n  if (contentType.indexOf('application/vnd.api+json') === 0 && processJSONAPI) {\n    return json.then(jsonapi)\n  } else {\n    return json\n  }\n}\n\nexport function handleInvalidTokenError(error) {\n  try {\n    const currentOrigin = window.location.origin\n    const requestUrl = error.url\n\n    if (\n      requestUrl.indexOf(\n        currentOrigin.replace(/^(https?:\\/\\/\\w+)-\\w+\\./, '$1.')\n      ) === 0\n    ) {\n      const redirectURL = `${currentOrigin}?${encodeQuery({ disconnect: 1 })}`\n      window.location = redirectURL\n    }\n  } catch (e) {\n    console.warn('Unable to handle invalid token error', e, error)\n  }\n}\n\nexport class FetchError extends Error {\n  constructor(res, reason) {\n    super()\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, this.constructor)\n    }\n    // XXX We have to hardcode this because babel doesn't play nice when extending Error\n    this.name = 'FetchError'\n    this.response = res\n    this.url = res.url\n    this.status = res.status\n    this.reason = reason\n\n    Object.defineProperty(this, 'message', {\n      value:\n        reason.message ||\n        (typeof reason === 'string' ? reason : JSON.stringify(reason))\n    })\n  }\n}\n\nFetchError.isUnauthorized = function(err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return err.name === 'FetchError' && err.status === 401\n}\n\nFetchError.isNotFound = function(err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return err.name === 'FetchError' && err.status === 404\n}\n\nFetchError.isInvalidToken = function(err) {\n  // XXX We can't use err instanceof FetchError because of the caveats of babel\n  return (\n    err.name === 'FetchError' &&\n    err.status === 400 &&\n    err.reason &&\n    (err.reason.error === 'Invalid JWT token' ||\n      err.reason.error === 'Expired token')\n  )\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/fetch.js","function indexKey(doc) {\n  return doc.type + '/' + doc.id\n}\n\nfunction findByRef(resources, ref) {\n  return resources[indexKey(ref)]\n}\n\nfunction handleResource(rawResource, resources, links) {\n  let resource = {\n    _id: rawResource.id,\n    _type: rawResource.type,\n    _rev: rawResource.meta && rawResource.meta.rev,\n    links: Object.assign({}, rawResource.links, links),\n    attributes: rawResource.attributes,\n    relations: name => {\n      let rels = rawResource.relationships[name]\n      if (rels === undefined || rels.data === undefined) return undefined\n      if (rels.data === null) return null\n      if (!Array.isArray(rels.data)) return findByRef(resources, rels.data)\n      return rels.data.map(ref => findByRef(resources, ref))\n    }\n  }\n  if (rawResource.relationships) {\n    resource.relationships = rawResource.relationships\n  }\n\n  resources[indexKey(rawResource)] = resource\n\n  return resource\n}\n\nfunction handleTopLevel(doc, resources = {}) {\n  // build an index of included resource by Type & ID\n  const included = doc.included\n\n  if (Array.isArray(included)) {\n    included.forEach(r => handleResource(r, resources, doc.links))\n  }\n\n  if (Array.isArray(doc.data)) {\n    return doc.data.map(r => handleResource(r, resources, doc.links))\n  } else {\n    return handleResource(doc.data, resources, doc.links)\n  }\n}\n\nexport default handleTopLevel\n\n\n\n// WEBPACK FOOTER //\n// ./src/jsonapi.js","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 11\n// module chunks = 0","import { createPath } from './utils'\nimport { normalizeDoctype } from './doctypes'\nimport { cozyFetchJSON } from './fetch'\n\nconst NOREV = 'stack-v2-no-rev'\n\nexport function create(cozy, doctype, attributes) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    if (isV2) {\n      attributes.docType = doctype\n    }\n    const path = createPath(cozy, isV2, doctype, attributes._id)\n    const httpVerb = attributes._id ? 'PUT' : 'POST'\n    delete attributes._id\n    return cozyFetchJSON(cozy, httpVerb, path, attributes).then(resp => {\n      if (isV2) {\n        return find(cozy, doctype, resp._id)\n      } else {\n        return resp.data\n      }\n    })\n  })\n}\n\nexport function find(cozy, doctype, id) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n\n    if (!id) {\n      return Promise.reject(new Error('Missing id parameter'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, id)\n    return cozyFetchJSON(cozy, 'GET', path).then(resp => {\n      if (isV2) {\n        return Object.assign(resp, { _rev: NOREV })\n      } else {\n        return resp\n      }\n    })\n  })\n}\n\nexport function findMany(cozy, doctype, ids) {\n  if (!(ids instanceof Array)) {\n    return Promise.reject(new Error('Parameter ids must be a non-empty array'))\n  }\n  if (ids.length === 0) {\n    // So users don't need to be defensive regarding the array content.\n    // This should not hide issues in user code since the result will be an\n    // empty object anyway.\n    return Promise.resolve({})\n  }\n\n  return cozy.isV2().then(isV2 => {\n    if (isV2) {\n      return Promise.reject(new Error('findMany is not available on v2'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, '_all_docs', {\n      include_docs: true\n    })\n\n    return cozyFetchJSON(cozy, 'POST', path, { keys: ids })\n      .then(resp => {\n        const docs = {}\n\n        for (const row of resp.rows) {\n          const { key, doc, error } = row\n          docs[key] = error ? { error } : { doc }\n        }\n\n        return docs\n      })\n      .catch(error => {\n        if (error.status !== 404) return Promise.reject(error)\n\n        // When no doc was ever created and the database does not exist yet,\n        // the response will be a 404 error.\n        const docs = {}\n\n        for (const id of ids) {\n          docs[id] = { error }\n        }\n\n        return docs\n      })\n  })\n}\n\nexport function findAll(cozy, doctype) {\n  return cozy.isV2().then(isV2 => {\n    if (isV2) {\n      return Promise.reject(new Error('findAll is not available on v2'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, '_all_docs', {\n      include_docs: true\n    })\n\n    return cozyFetchJSON(cozy, 'POST', path, {})\n      .then(resp => {\n        const docs = []\n\n        for (const row of resp.rows) {\n          const { doc } = row\n          // if not couchDB indexes\n          if (!doc._id.match(/_design\\//)) docs.push(doc)\n        }\n        return docs\n      })\n      .catch(error => {\n        // the _all_docs endpoint returns a 404 error if no document with the given\n        // doctype exists.\n        if (error.status === 404) return []\n        throw error\n      })\n  })\n}\n\nexport function changesFeed(cozy, doctype, options) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const path = createPath(cozy, isV2, doctype, '_changes', options)\n    return cozyFetchJSON(cozy, 'GET', path)\n  })\n}\n\nexport function update(cozy, doctype, doc, changes) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const { _id, _rev } = doc\n\n    if (!_id) {\n      return Promise.reject(new Error('Missing _id field in passed document'))\n    }\n\n    if (!isV2 && !_rev) {\n      return Promise.reject(new Error('Missing _rev field in passed document'))\n    }\n\n    if (isV2) {\n      changes = Object.assign({ _id }, changes)\n    } else {\n      changes = Object.assign({ _id, _rev }, changes)\n    }\n\n    const path = createPath(cozy, isV2, doctype, _id)\n    return cozyFetchJSON(cozy, 'PUT', path, changes).then(resp => {\n      if (isV2) {\n        return find(cozy, doctype, _id)\n      } else {\n        return resp.data\n      }\n    })\n  })\n}\n\nexport function updateAttributes(cozy, doctype, _id, changes, tries = 3) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    return find(cozy, doctype, _id)\n      .then(doc => {\n        return update(cozy, doctype, doc, Object.assign({ _id }, doc, changes))\n      })\n      .catch(err => {\n        if (tries > 0) {\n          return updateAttributes(cozy, doctype, _id, changes, tries - 1)\n        } else {\n          throw err\n        }\n      })\n  })\n}\n\nexport function _delete(cozy, doctype, doc) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const { _id, _rev } = doc\n\n    if (!_id) {\n      return Promise.reject(new Error('Missing _id field in passed document'))\n    }\n\n    if (!isV2 && !_rev) {\n      return Promise.reject(new Error('Missing _rev field in passed document'))\n    }\n\n    const query = isV2 ? null : { rev: _rev }\n    const path = createPath(cozy, isV2, doctype, _id, query)\n    return cozyFetchJSON(cozy, 'DELETE', path).then(resp => {\n      if (isV2) {\n        return { id: _id, rev: NOREV }\n      } else {\n        return resp\n      }\n    })\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/data.js","import { warn } from './utils'\n\nexport const DOCTYPE_FILES = 'io.cozy.files'\n\nconst KNOWN_DOCTYPES = {\n  files: DOCTYPE_FILES,\n  folder: DOCTYPE_FILES,\n  contact: 'io.cozy.contacts',\n  event: 'io.cozy.events',\n  track: 'io.cozy.labs.music.track',\n  playlist: 'io.cozy.labs.music.playlist'\n}\n\nconst REVERSE_KNOWN = {}\nObject.keys(KNOWN_DOCTYPES).forEach(k => {\n  REVERSE_KNOWN[KNOWN_DOCTYPES[k]] = k\n})\n\nexport function normalizeDoctype(cozy, isV2, doctype) {\n  let isQualified = doctype.indexOf('.') !== -1\n  if (isV2 && isQualified) {\n    let known = REVERSE_KNOWN[doctype]\n    if (known) return known\n    return doctype.replace(/\\./g, '-')\n  }\n  if (!isV2 && !isQualified) {\n    let known = KNOWN_DOCTYPES[doctype]\n    if (known) {\n      warn(\n        'you are using a non-qualified doctype ' +\n          doctype +\n          ' assumed to be ' +\n          known\n      )\n      return known\n    }\n    throw new Error('Doctype ' + doctype + ' should be qualified.')\n  }\n  return doctype\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/doctypes.js","import { warn, createPath, sleep } from './utils'\nimport { normalizeDoctype } from './doctypes'\nimport { cozyFetchJSON, cozyFetchRawJSON } from './fetch'\n\nexport function defineIndex(cozy, doctype, fields) {\n  return cozy.isV2().then(isV2 => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    if (!Array.isArray(fields) || fields.length === 0) {\n      throw new Error('defineIndex fields should be a non-empty array')\n    }\n    if (isV2) {\n      return defineIndexV2(cozy, doctype, fields)\n    } else {\n      return defineIndexV3(cozy, doctype, fields)\n    }\n  })\n}\n\nexport function query(cozy, indexRef, options) {\n  return cozy.isV2().then(isV2 => {\n    if (!indexRef) {\n      throw new Error('query should be passed the indexRef')\n    }\n    if (isV2) {\n      return queryV2(cozy, indexRef, options)\n    } else {\n      return queryV3(cozy, indexRef, options)\n    }\n  })\n}\n\nexport function queryFiles(cozy, indexRef, options) {\n  const opts = getV3Options(indexRef, options)\n  return cozyFetchRawJSON(cozy, 'POST', '/files/_find', opts).then(\n    response => (options.wholeResponse ? response : response.docs)\n  )\n}\n\n// Internals\n\nconst VALUEOPERATORS = ['$eq', '$gt', '$gte', '$lt', '$lte']\nconst LOGICOPERATORS = ['$or', '$and', '$not']\n\n/* eslint-disable */\nconst MAP_TEMPLATE = function(doc) {\n  if (doc.docType.toLowerCase() === 'DOCTYPEPLACEHOLDER') {\n    emit(FIELDSPLACEHOLDER, doc)\n  }\n}\n  .toString()\n  .replace(/ /g, '')\n  .replace(/\\n/g, '')\nconst COUCHDB_INFINITY = { '\\uFFFF': '\\uFFFF' }\nconst COUCHDB_LOWEST = null\n/* eslint-enable */\n\n// defineIndexV2 is equivalent to defineIndex but only works for V2.\n// It transforms the index fields into a map reduce view.\nfunction defineIndexV2(cozy, doctype, fields) {\n  let indexName = 'by' + fields.map(capitalize).join('')\n  let indexDefinition = {\n    map: makeMapFunction(doctype, fields),\n    reduce: '_count'\n  }\n  let path = `/request/${doctype}/${indexName}/`\n  return cozyFetchJSON(cozy, 'PUT', path, indexDefinition).then(() => ({\n    doctype: doctype,\n    type: 'mapreduce',\n    name: indexName,\n    fields: fields\n  }))\n}\n\nfunction defineIndexV3(cozy, doctype, fields) {\n  let path = createPath(cozy, false, doctype, '_index')\n  let indexDefinition = { index: { fields } }\n  return cozyFetchJSON(cozy, 'POST', path, indexDefinition).then(response => {\n    const indexResult = {\n      doctype: doctype,\n      type: 'mango',\n      name: response.id,\n      fields\n    }\n\n    if (response.result === 'exists') return indexResult\n\n    // indexes might not be usable right after being created; so we delay the resolving until they are\n    const selector = {}\n    selector[fields[0]] = { $gt: null }\n\n    const opts = getV3Options(indexResult, { selector: selector })\n    let path = createPath(cozy, false, indexResult.doctype, '_find')\n    return cozyFetchJSON(cozy, 'POST', path, opts)\n      .then(() => indexResult)\n      .catch(() => {\n        // one retry\n        return sleep(1000)\n          .then(() => cozyFetchJSON(cozy, 'POST', path, opts))\n          .then(() => indexResult)\n          .catch(() => {\n            return sleep(500).then(() => indexResult)\n          })\n      })\n  })\n}\n\n// queryV2 is equivalent to query but only works for V2.\n// It transforms the query into a _views call using makeMapReduceQuery\nfunction queryV2(cozy, indexRef, options) {\n  if (indexRef.type !== 'mapreduce') {\n    throw new Error(\n      'query indexRef should be the return value of defineIndexV2'\n    )\n  }\n  if (options.fields) {\n    warn('query fields will be ignored on v2')\n  }\n\n  let path = `/request/${indexRef.doctype}/${indexRef.name}/`\n  let opts = makeMapReduceQuery(indexRef, options)\n  return cozyFetchJSON(cozy, 'POST', path, opts).then(response =>\n    response.map(r => r.value)\n  )\n}\n\n// queryV3 is equivalent to query but only works for V3\nfunction queryV3(cozy, indexRef, options) {\n  const opts = getV3Options(indexRef, options)\n\n  let path = createPath(cozy, false, indexRef.doctype, '_find')\n  return cozyFetchJSON(cozy, 'POST', path, opts).then(\n    response => (options.wholeResponse ? response : response.docs)\n  )\n}\n\nfunction getV3Options(indexRef, options) {\n  if (indexRef.type !== 'mango') {\n    throw new Error('indexRef should be the return value of defineIndexV3')\n  }\n\n  let opts = {\n    use_index: indexRef.name,\n    fields: options.fields,\n    selector: options.selector,\n    limit: options.limit,\n    skip: options.skip,\n    since: options.since,\n    sort: options.sort\n  }\n\n  if (options.descending) {\n    opts.sort = indexRef.fields.map(f => ({ [f]: 'desc' }))\n  }\n\n  return opts\n}\n\n// misc\nfunction capitalize(name) {\n  return name.charAt(0).toUpperCase() + name.slice(1)\n}\n\nfunction makeMapFunction(doctype, fields) {\n  fields = '[' + fields.map(name => 'doc.' + name).join(',') + ']'\n\n  return MAP_TEMPLATE.replace(\n    'DOCTYPEPLACEHOLDER',\n    doctype.toLowerCase()\n  ).replace('FIELDSPLACEHOLDER', fields)\n}\n\n// parseSelector takes a mango selector and returns it as an array of filter\n// a filter is [path, operator, value] array\n// a path is an array of field names\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// [[['test', 'deep'], '$gt', 3 ]]\nexport function parseSelector(selector, path = [], operator = '$eq') {\n  if (typeof selector !== 'object') {\n    return [[path, operator, selector]]\n  }\n\n  let keys = Object.keys(selector)\n  if (keys.length === 0) {\n    throw new Error('empty selector')\n  } else {\n    return keys.reduce(function(acc, k) {\n      if (LOGICOPERATORS.indexOf(k) !== -1) {\n        throw new Error('cozy-client-js does not support mango logic ops')\n      } else if (VALUEOPERATORS.indexOf(k) !== -1) {\n        return acc.concat(parseSelector(selector[k], path, k))\n      } else {\n        return acc.concat(parseSelector(selector[k], path.concat(k), '$eq'))\n      }\n    }, [])\n  }\n}\n\n// normalizeSelector takes a mango selector and returns it as an object\n// normalized.\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// {\"test.deep\": {\"$gt\": 3}}\nexport function normalizeSelector(selector) {\n  var filters = parseSelector(selector)\n  return filters.reduce(function(acc, filter) {\n    let [path, op, value] = filter\n    let field = path.join('.')\n    acc[field] = acc[field] || {}\n    acc[field][op] = value\n    return acc\n  }, {})\n}\n\n// applySelector takes the normalized selector for the current field\n// and append the proper values to opts.startkey, opts.endkey\nfunction applySelector(selector, opts) {\n  let value = selector['$eq']\n  let lower = COUCHDB_LOWEST\n  let upper = COUCHDB_INFINITY\n  let inclusiveEnd\n\n  if (value) {\n    opts.startkey.push(value)\n    opts.endkey.push(value)\n    return false\n  }\n\n  value = selector['$gt']\n  if (value) {\n    throw new Error('operator $gt (strict greater than) not supported')\n  }\n\n  value = selector['$gte']\n  if (value) {\n    lower = value\n  }\n\n  value = selector['$lte']\n  if (value) {\n    upper = value\n    inclusiveEnd = true\n  }\n\n  value = selector['$lt']\n  if (value) {\n    upper = value\n    inclusiveEnd = false\n  }\n\n  opts.startkey.push(lower)\n  opts.endkey.push(upper)\n  if (inclusiveEnd !== undefined) opts.inclusive_end = inclusiveEnd\n  return true\n}\n\n// makeMapReduceQuery takes a mango query and generate _views call parameters\n// to obtain same results depending on fields in the passed indexRef.\nexport function makeMapReduceQuery(indexRef, query) {\n  let mrquery = {\n    startkey: [],\n    endkey: [],\n    reduce: false\n  }\n  let firstFreeValueField = null\n  let normalizedSelector = normalizeSelector(query.selector)\n\n  indexRef.fields.forEach(function(field) {\n    let selector = normalizedSelector[field]\n\n    if (selector && firstFreeValueField != null) {\n      throw new Error(\n        'Selector on field ' +\n          field +\n          ', but not on ' +\n          firstFreeValueField +\n          ' which is higher in index fields.'\n      )\n    } else if (selector) {\n      selector.used = true\n      let isFreeValue = applySelector(selector, mrquery)\n      if (isFreeValue) firstFreeValueField = field\n    } else if (firstFreeValueField == null) {\n      firstFreeValueField = field\n      mrquery.endkey.push(COUCHDB_INFINITY)\n    }\n  })\n\n  Object.keys(normalizedSelector).forEach(function(field) {\n    if (!normalizedSelector[field].used) {\n      throw new Error(\n        'Cant apply selector on ' + field + ', it is not in index'\n      )\n    }\n  })\n\n  if (query.descending) {\n    mrquery = {\n      descending: true,\n      reduce: false,\n      startkey: mrquery.endkey,\n      endkey: mrquery.startkey,\n      inclusive_end: mrquery.inclusive_end\n    }\n  }\n\n  return mrquery\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mango.js","/* global Blob, File */\nimport { cozyFetch, cozyFetchJSON } from './fetch'\nimport jsonapi from './jsonapi'\nimport { DOCTYPE_FILES } from './doctypes'\n\n// global variables\nexport const ROOT_DIR_ID = 'io.cozy.files.root-dir'\nexport const TRASH_DIR_ID = 'io.cozy.files.trash-dir'\n\nconst contentTypeOctetStream = 'application/octet-stream'\n\nfunction sanitizeFileName(name) {\n  return name && name.trim()\n}\n\nfunction getFileTypeFromName(name) {\n  if (/\\.heic$/i.test(name)) return 'image/heic'\n  else if (/\\.heif$/i.test(name)) return 'image/heif'\n  else return null\n}\n\nfunction doUpload(cozy, data, method, path, options) {\n  if (!data) {\n    throw new Error('missing data argument')\n  }\n\n  // transform any ArrayBufferView to ArrayBuffer\n  if (data.buffer && data.buffer instanceof ArrayBuffer) {\n    data = data.buffer\n  }\n\n  const isBuffer =\n    typeof ArrayBuffer !== 'undefined' && data instanceof ArrayBuffer\n  const isFile = typeof File !== 'undefined' && data instanceof File\n  const isBlob = typeof Blob !== 'undefined' && data instanceof Blob\n  const isStream = data.readable === true && typeof data.pipe === 'function'\n  const isString = typeof data === 'string'\n\n  if (!isBuffer && !isFile && !isBlob && !isStream && !isString) {\n    throw new Error('invalid data type')\n  }\n\n  let { contentType, contentLength, checksum, lastModifiedDate, ifMatch } =\n    options || {}\n  if (!contentType) {\n    if (isBuffer) {\n      contentType = contentTypeOctetStream\n    } else if (isFile) {\n      contentType =\n        data.type ||\n        getFileTypeFromName(data.name.toLowerCase()) ||\n        contentTypeOctetStream\n      if (!lastModifiedDate) {\n        lastModifiedDate = data.lastModifiedDate\n      }\n    } else if (isBlob) {\n      contentType = data.type || contentTypeOctetStream\n    } else if (isStream) {\n      contentType = contentTypeOctetStream\n    } else if (typeof data === 'string') {\n      contentType = 'text/plain'\n    }\n  }\n\n  if (lastModifiedDate && typeof lastModifiedDate === 'string') {\n    lastModifiedDate = new Date(lastModifiedDate)\n  }\n\n  const headers = {\n    'Content-Type': contentType\n  }\n  if (contentLength) headers['Content-Length'] = String(contentLength)\n  if (checksum) headers['Content-MD5'] = checksum\n  if (lastModifiedDate) headers['Date'] = lastModifiedDate.toGMTString()\n  if (ifMatch) headers['If-Match'] = ifMatch\n\n  return cozyFetch(cozy, path, {\n    method: method,\n    headers: headers,\n    body: data\n  }).then(res => {\n    const json = res.json()\n    if (!res.ok) {\n      return json.then(err => {\n        throw err\n      })\n    } else {\n      return json.then(jsonapi)\n    }\n  })\n}\n\nexport function create(cozy, data, options) {\n  let { name, dirID, executable } = options || {}\n\n  // handle case where data is a file and contains the name\n  if (!name && typeof data.name === 'string') {\n    name = data.name\n  }\n\n  name = sanitizeFileName(name)\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  if (executable === undefined) {\n    executable = false\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(\n    name\n  )}&Type=file&Executable=${executable}`\n  return doUpload(cozy, data, 'POST', `${path}${query}`, options)\n}\n\nexport function createDirectory(cozy, options) {\n  let { name, dirID, lastModifiedDate } = options || {}\n\n  name = sanitizeFileName(name)\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  if (lastModifiedDate && typeof lastModifiedDate === 'string') {\n    lastModifiedDate = new Date(lastModifiedDate)\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(name)}&Type=directory`\n  return cozyFetchJSON(cozy, 'POST', `${path}${query}`, undefined, {\n    headers: {\n      Date: lastModifiedDate ? lastModifiedDate.toGMTString() : ''\n    }\n  })\n}\n\nfunction getDirectoryOrCreate(cozy, name, parentDirectory) {\n  if (parentDirectory && !parentDirectory.attributes)\n    throw new Error('Malformed parent directory')\n\n  name = sanitizeFileName(name)\n\n  const path = `${\n    parentDirectory._id === ROOT_DIR_ID ? '' : parentDirectory.attributes.path\n  }/${name}`\n\n  return cozy.files.statByPath(path || '/').catch(error => {\n    const parsedError = JSON.parse(error.message)\n    const errors = parsedError.errors\n    if (errors && errors.length && errors[0].status === '404') {\n      return cozy.files.createDirectory({\n        name: name,\n        dirID: parentDirectory && parentDirectory._id\n      })\n    }\n\n    throw errors\n  })\n}\n\nexport function createDirectoryByPath(cozy, path, offline) {\n  const parts = path.split('/').filter(part => part !== '')\n\n  const rootDirectoryPromise = cozy.files.statById(ROOT_DIR_ID, offline)\n\n  return parts.length\n    ? parts.reduce((parentDirectoryPromise, part) => {\n        return parentDirectoryPromise.then(parentDirectory =>\n          getDirectoryOrCreate(cozy, part, parentDirectory)\n        )\n      }, rootDirectoryPromise)\n    : rootDirectoryPromise\n}\n\nexport function updateById(cozy, id, data, options) {\n  return doUpload(\n    cozy,\n    data,\n    'PUT',\n    `/files/${encodeURIComponent(id)}`,\n    options\n  )\n}\n\nfunction doUpdateAttributes(cozy, attrs, path, options) {\n  if (!attrs || typeof attrs !== 'object') {\n    throw new Error('missing attrs argument')\n  }\n\n  const { ifMatch } = options || {}\n  const body = {\n    data: {\n      attributes: Object.assign({}, attrs, {\n        name: sanitizeFileName(attrs.name)\n      })\n    }\n  }\n  return cozyFetchJSON(cozy, 'PATCH', path, body, {\n    headers: {\n      'If-Match': ifMatch || ''\n    }\n  })\n}\n\nexport function updateAttributesById(cozy, id, attrs, options) {\n  return doUpdateAttributes(\n    cozy,\n    attrs,\n    `/files/${encodeURIComponent(id)}`,\n    options\n  )\n}\n\nexport function updateAttributesByPath(cozy, path, attrs, options) {\n  return doUpdateAttributes(\n    cozy,\n    attrs,\n    `/files/metadata?Path=${encodeURIComponent(path)}`,\n    options\n  )\n}\n\nexport function trashById(cozy, id, options) {\n  if (typeof id !== 'string' || id === '') {\n    throw new Error('missing id argument')\n  }\n  const { ifMatch } = options || {}\n  return cozyFetchJSON(\n    cozy,\n    'DELETE',\n    `/files/${encodeURIComponent(id)}`,\n    undefined,\n    {\n      headers: {\n        'If-Match': ifMatch || ''\n      }\n    }\n  )\n}\n\nexport function statById(cozy, id, offline = true, options = {}) {\n  if (offline && cozy.offline.hasDatabase(DOCTYPE_FILES)) {\n    let db = cozy.offline.getDatabase(DOCTYPE_FILES)\n    return Promise.all([\n      db.get(id),\n      db.find(Object.assign({ selector: { dir_id: id } }, options))\n    ]).then(([doc, children]) => {\n      if (id === ROOT_DIR_ID) {\n        children.docs = children.docs.filter(doc => doc._id !== TRASH_DIR_ID)\n      }\n      children = sortFiles(\n        children.docs.map(doc => addIsDir(toJsonApi(cozy, doc)))\n      )\n      return addIsDir(toJsonApi(cozy, doc, children))\n    })\n  }\n  const query =\n    Object.keys(options).length === 0 ? '' : `?${encodePageOptions(options)}`\n  return cozyFetchJSON(\n    cozy,\n    'GET',\n    `/files/${encodeURIComponent(id)}${query}`\n  ).then(addIsDir)\n}\n\nexport function statByPath(cozy, path) {\n  return cozyFetchJSON(\n    cozy,\n    'GET',\n    `/files/metadata?Path=${encodeURIComponent(path)}`\n  ).then(addIsDir)\n}\n\nexport function downloadById(cozy, id) {\n  return cozyFetch(cozy, `/files/download/${encodeURIComponent(id)}`)\n}\n\nexport function downloadByPath(cozy, path) {\n  return cozyFetch(cozy, `/files/download?Path=${encodeURIComponent(path)}`)\n}\n\nfunction extractResponseLinkRelated(res) {\n  let href = res.links && res.links.related\n  if (!href) throw new Error('No related link in server response')\n  return href\n}\n\nexport function getDownloadLinkByPath(cozy, path) {\n  return cozyFetchJSON(\n    cozy,\n    'POST',\n    `/files/downloads?Path=${encodeURIComponent(path)}`\n  ).then(extractResponseLinkRelated)\n}\n\nexport function getDownloadLinkById(cozy, id) {\n  return cozyFetchJSON(\n    cozy,\n    'POST',\n    `/files/downloads?Id=${encodeURIComponent(id)}`\n  ).then(extractResponseLinkRelated)\n}\n\nexport function getFilePath(cozy, file = {}, folder) {\n  if (!folder || !folder.attributes) {\n    throw Error('Folder should be valid with an attributes.path property')\n  }\n\n  const folderPath = folder.attributes.path.endsWith('/')\n    ? folder.attributes.path\n    : `${folder.attributes.path}/`\n\n  return `${folderPath}${file.name}`\n}\n\nexport function getCollectionShareLink(cozy, id, collectionType) {\n  if (!id) {\n    return Promise.reject(\n      Error('An id should be provided to create a share link')\n    )\n  }\n  return cozyFetchJSON(cozy, 'POST', `/permissions?codes=email`, {\n    data: {\n      type: 'io.cozy.permissions',\n      attributes: {\n        permissions: {\n          files: {\n            type: 'io.cozy.files',\n            verbs: ['GET'],\n            values: [id],\n            selector: 'referenced_by'\n          },\n          collection: {\n            type: collectionType,\n            verbs: ['GET'],\n            values: [id]\n          }\n        }\n      }\n    }\n  }).then(data => ({\n    sharecode: `sharecode=${data.attributes.codes.email}`,\n    id: `id=${id}`\n  }))\n}\n\nexport function getArchiveLinkByPaths(cozy, paths, name = 'files') {\n  const archive = {\n    type: 'io.cozy.archives',\n    attributes: {\n      name: name,\n      files: paths\n    }\n  }\n  return cozyFetchJSON(cozy, 'POST', `/files/archive`, { data: archive }).then(\n    extractResponseLinkRelated\n  )\n}\n\nexport function getArchiveLinkByIds(cozy, ids, name = 'files') {\n  const archive = {\n    type: 'io.cozy.archives',\n    attributes: {\n      name: name,\n      ids: ids\n    }\n  }\n  return cozyFetchJSON(cozy, 'POST', `/files/archive`, { data: archive }).then(\n    extractResponseLinkRelated\n  )\n}\n\nexport function listTrash(cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/files/trash`)\n}\n\nexport function clearTrash(cozy) {\n  return cozyFetchJSON(cozy, 'DELETE', `/files/trash`)\n}\n\nexport function restoreById(cozy, id) {\n  return cozyFetchJSON(cozy, 'POST', `/files/trash/${encodeURIComponent(id)}`)\n}\n\nexport function destroyById(cozy, id, options) {\n  const { ifMatch } = options || {}\n  return cozyFetchJSON(\n    cozy,\n    'DELETE',\n    `/files/trash/${encodeURIComponent(id)}`,\n    undefined,\n    {\n      headers: {\n        'If-Match': ifMatch || ''\n      }\n    }\n  )\n}\n\nfunction addIsDir(obj) {\n  obj.isDir = obj.attributes.type === 'directory'\n  return obj\n}\n\nfunction encodePageOptions(options) {\n  let opts = []\n  for (const name in options) {\n    opts.push(\n      `page[${encodeURIComponent(name)}]=${encodeURIComponent(options[name])}`\n    )\n  }\n  return opts.join('&')\n}\n\nfunction toJsonApi(cozy, doc, contents = []) {\n  let clone = JSON.parse(JSON.stringify(doc))\n  delete clone._id\n  delete clone._rev\n  return {\n    _id: doc._id,\n    _rev: doc._rev,\n    _type: DOCTYPE_FILES,\n    attributes: clone,\n    relationships: {\n      contents: {\n        data: contents,\n        meta: {\n          count: contents.length\n        }\n      }\n    },\n    relations: name => {\n      if (name === 'contents') {\n        return contents\n      }\n    }\n  }\n}\n\nfunction sortFiles(allFiles) {\n  const folders = allFiles.filter(f => f.attributes.type === 'directory')\n  const files = allFiles.filter(f => f.attributes.type !== 'directory')\n  const sort = files =>\n    files.sort((a, b) => a.attributes.name.localeCompare(b.attributes.name))\n  return sort(folders).concat(sort(files))\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/files.js","import { cozyFetchJSON } from '../fetch'\nimport { pickService } from './helpers'\nimport * as client from './client'\nimport * as service from './service'\n\nexport function create(cozy, action, type, data = {}, permissions = []) {\n  if (!action)\n    throw new Error(`Misformed intent, \"action\" property must be provided`)\n  if (!type)\n    throw new Error(`Misformed intent, \"type\" property must be provided`)\n\n  const createPromise = cozyFetchJSON(cozy, 'POST', '/intents', {\n    data: {\n      type: 'io.cozy.intents',\n      attributes: {\n        action: action,\n        type: type,\n        data: data,\n        permissions: permissions\n      }\n    }\n  })\n\n  createPromise.start = (element, onReadyCallback) => {\n    const options = {\n      filteredServices: data.filteredServices,\n      onReadyCallback: onReadyCallback\n    }\n\n    delete data.filteredServices\n\n    return createPromise.then(intent =>\n      client.start(cozy, intent, element, data, options)\n    )\n  }\n\n  return createPromise\n}\n\n// returns a service to communicate with intent client\nexport function createService(cozy, intentId, serviceWindow) {\n  return service.start(cozy, intentId, serviceWindow)\n}\n\n// Redirect to an app able to handle the doctype\n// Redirections are more or less a hack of the intent API to retrieve an URL for\n// accessing a given doctype or a given document.\n// It needs to use a special action `REDIRECT`\nexport async function getRedirectionURL(cozy, type, data) {\n  if (!type && !data)\n    throw new Error(\n      `Cannot retrieve redirection, at least type or doc must be provided`\n    )\n\n  const intent = await create(cozy, 'REDIRECT', type, data)\n\n  const service = pickService(intent)\n  if (!service) throw new Error('Unable to find a service')\n\n  // Intents cannot be deleted now\n  // await deleteIntent(cozy, intent)\n\n  // ignore query string and intent id\n  const baseURL = service.href.split('?')[0]\n  // FIXME: Handle the fact that the stack encode the '#' character in the URL\n  const sanitizedURL = baseURL.replace('%23', '#')\n  return data ? buildRedirectionURL(sanitizedURL, data) : sanitizedURL\n}\n\nfunction isSerializable(value) {\n  return !['object', 'function'].includes(typeof value)\n}\n\nfunction buildRedirectionURL(url, data) {\n  const parameterStrings = Object.keys(data)\n    .filter(key => isSerializable(data[key]))\n    .map(key => `${key}=${data[key]}`)\n\n  return parameterStrings.length ? `${url}?${parameterStrings.join('&')}` : url\n}\n\nexport async function redirect(cozy, type, doc) {\n  if (!window)\n    throw new Error('redirect() method can only be called in a browser')\n  const redirectionURL = await getRedirectionURL(cozy, type, doc)\n  window.location.href = redirectionURL\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/intents/index.js","module.exports = require(\"babel-runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/regenerator\"\n// module id = 17\n// module chunks = 0","// helper to serialize/deserialize an error for/from postMessage\nexport const errorSerializer = (() => {\n  function mapErrorProperties(from, to) {\n    const result = Object.assign(to, from)\n    const nativeProperties = ['name', 'message']\n    return nativeProperties.reduce((result, property) => {\n      if (from[property]) {\n        to[property] = from[property]\n      }\n      return result\n    }, result)\n  }\n  return {\n    serialize: error => mapErrorProperties(error, {}),\n    deserialize: data => mapErrorProperties(data, new Error(data.message))\n  }\n})()\n\nconst first = arr => arr && arr[0]\n// In a far future, the user will have to pick the desired service from a list.\n// For now it's our job, an easy job as we arbitrary pick the first service of\n// the list.\nexport function pickService(intent, filterServices) {\n  const services = intent.attributes.services\n  const filteredServices = filterServices\n    ? (services || []).filter(filterServices)\n    : services\n  return first(filteredServices)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/intents/helpers.js","import { errorSerializer, pickService } from './helpers'\nimport { create as createIntent } from './'\n\nconst intentClass = 'coz-intent'\n\nfunction hideIntentIframe(iframe) {\n  iframe.style.display = 'none'\n}\n\nfunction showIntentFrame(iframe) {\n  iframe.style.display = 'block'\n}\n\nfunction buildIntentIframe(intent, element, url) {\n  const document = element.ownerDocument\n  if (!document)\n    return Promise.reject(\n      new Error('Cannot retrieve document object from given element')\n    )\n\n  const iframe = document.createElement('iframe')\n  // TODO: implement 'title' attribute\n  iframe.setAttribute('id', `intent-${intent._id}`)\n  iframe.setAttribute('src', url)\n  iframe.classList.add(intentClass)\n  return iframe\n}\n\nfunction injectIntentIframe(intent, element, url, options) {\n  const { onReadyCallback } = options\n  const iframe = buildIntentIframe(\n    intent,\n    element,\n    url,\n    options.onReadyCallback\n  )\n  // if callback provided for when iframe is loaded\n  if (typeof onReadyCallback === 'function') iframe.onload = onReadyCallback\n  element.appendChild(iframe)\n  iframe.focus()\n  return iframe\n}\n\n// inject iframe for service in given element\nfunction connectIntentIframe(cozy, iframe, element, intent, data) {\n  const document = element.ownerDocument\n  if (!document)\n    return Promise.reject(\n      new Error('Cannot retrieve document object from given element')\n    )\n\n  const window = document.defaultView\n  if (!window)\n    return Promise.reject(\n      new Error('Cannot retrieve window object from document')\n    )\n\n  // Keeps only http://domain:port/\n  const serviceOrigin = iframe.src.split('/', 3).join('/')\n\n  async function compose(cozy, action, doctype, data) {\n    const intent = await createIntent(cozy, action, doctype, data)\n    hideIntentIframe(iframe)\n    const doc = await start(cozy, intent, element, {\n      ...data,\n      exposeIntentFrameRemoval: false\n    })\n    showIntentFrame(iframe)\n    return doc\n  }\n\n  return new Promise((resolve, reject) => {\n    let handshaken = false\n    const messageHandler = async event => {\n      if (event.origin !== serviceOrigin) return\n\n      const eventType = event.data.type\n      if (eventType === 'load') {\n        // Safari 9.1 (At least) send a MessageEvent when the iframe loads,\n        // making the handshake fails.\n        console.warn &&\n          console.warn(\n            'Cozy Client ignored MessageEvent having data.type `load`.'\n          )\n        return\n      }\n\n      if (eventType === `intent-${intent._id}:ready`) {\n        handshaken = true\n        return event.source.postMessage(data, event.origin)\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:resize`) {\n        ;['width', 'height', 'maxWidth', 'maxHeight'].forEach(prop => {\n          if (event.data.transition)\n            element.style.transition = event.data.transition\n          if (event.data.dimensions[prop])\n            element.style[prop] = `${event.data.dimensions[prop]}px`\n        })\n\n        return true\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:compose`) {\n        // Let start to name `type` as `doctype`, as `event.data` already have a `type` attribute.\n        const { action, doctype, data } = event.data\n        const doc = await compose(cozy, action, doctype, data)\n        return event.source.postMessage(doc, event.origin)\n      }\n\n      window.removeEventListener('message', messageHandler)\n      const removeIntentFrame = () => {\n        // check if the parent node has not been already removed from the DOM\n        iframe.parentNode && iframe.parentNode.removeChild(iframe)\n      }\n\n      if (\n        handshaken &&\n        eventType === `intent-${intent._id}:exposeFrameRemoval`\n      ) {\n        return resolve({ removeIntentFrame, doc: event.data.document })\n      }\n\n      removeIntentFrame()\n\n      if (eventType === `intent-${intent._id}:error`) {\n        return reject(errorSerializer.deserialize(event.data.error))\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:cancel`) {\n        return resolve(null)\n      }\n\n      if (handshaken && eventType === `intent-${intent._id}:done`) {\n        return resolve(event.data.document)\n      }\n\n      if (!handshaken) {\n        return reject(\n          new Error('Unexpected handshake message from intent service')\n        )\n      }\n\n      // We may be in a state where the messageHandler is still attached to then\n      // window, but will not be needed anymore. For example, the service failed\n      // before adding the `unload` listener, so no `intent:cancel` message has\n      // never been sent.\n      // So we simply ignore other messages, and this listener will stay here,\n      // waiting for a message which will never come, forever (almost).\n    }\n\n    window.addEventListener('message', messageHandler)\n  })\n}\n\nexport function start(cozy, intent, element, data = {}, options = {}) {\n  const service = pickService(intent, options.filterServices)\n\n  if (!service) {\n    throw new Error('Unable to find a service')\n  }\n\n  const iframe = injectIntentIframe(intent, element, service.href, options)\n\n  return connectIntentIframe(\n    cozy,\n    iframe,\n    element,\n    intent,\n    data,\n    options.onReadyCallback\n  )\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/intents/client.js","import { cozyFetchJSON } from '../fetch'\nimport { errorSerializer } from './helpers'\n\nfunction listenClientData(intent, window) {\n  return new Promise(resolve => {\n    const messageEventListener = event => {\n      if (event.origin !== intent.attributes.client) return\n\n      window.removeEventListener('message', messageEventListener)\n      resolve(event.data)\n    }\n\n    window.addEventListener('message', messageEventListener)\n    window.parent.postMessage(\n      {\n        type: `intent-${intent._id}:ready`\n      },\n      intent.attributes.client\n    )\n  })\n}\n\n// maximize the height of an element\nfunction maximize(element) {\n  if (element && element.style) {\n    element.style.height = '100%'\n  }\n}\n\nexport function start(cozy, intentId, serviceWindow) {\n  serviceWindow = serviceWindow || (typeof window !== 'undefined' && window)\n  if (!serviceWindow || !serviceWindow.document) {\n    return Promise.reject(new Error('Intent service should be used in browser'))\n  }\n\n  // Maximize document, the whole iframe is handled by intents, clients and\n  // services\n  serviceWindow.addEventListener('load', () => {\n    const { document } = serviceWindow\n    ;[document.documentElement, document.body].forEach(maximize)\n  })\n\n  intentId = intentId || serviceWindow.location.search.split('=')[1]\n  if (!intentId)\n    return Promise.reject(new Error('Cannot retrieve intent from URL'))\n\n  return cozyFetchJSON(cozy, 'GET', `/intents/${intentId}`).then(intent => {\n    let terminated = false\n\n    const sendMessage = message => {\n      if (terminated)\n        throw new Error('Intent service has already been terminated')\n      serviceWindow.parent.postMessage(message, intent.attributes.client)\n    }\n\n    const compose = (action, doctype, data) =>\n      new Promise(resolve => {\n        const composeEventListener = event => {\n          if (event.origin !== intent.attributes.client) return\n          serviceWindow.removeEventListener('message', composeEventListener)\n          return resolve(event.data)\n        }\n\n        serviceWindow.addEventListener('message', composeEventListener)\n\n        sendMessage({\n          type: `intent-${intent._id}:compose`,\n          action,\n          doctype,\n          data\n        })\n      })\n\n    const terminate = message => {\n      sendMessage(message)\n      terminated = true\n    }\n\n    const resizeClient = (dimensions, transitionProperty) => {\n      if (terminated) throw new Error('Intent service has been terminated')\n\n      sendMessage({\n        type: `intent-${intent._id}:resize`,\n        // if a dom element is passed, calculate its size\n        dimensions: dimensions.element\n          ? Object.assign({}, dimensions, {\n              maxHeight: dimensions.element.clientHeight,\n              maxWidth: dimensions.element.clientWidth\n            })\n          : dimensions,\n        transition: transitionProperty\n      })\n    }\n\n    const cancel = () => {\n      terminate({ type: `intent-${intent._id}:cancel` })\n    }\n\n    // Prevent unfulfilled client promises when this window unloads for a\n    // reason or another.\n    serviceWindow.addEventListener('unload', () => {\n      if (!terminated) cancel()\n    })\n\n    return listenClientData(intent, serviceWindow).then(data => {\n      return {\n        compose: compose,\n        getData: () => data,\n        getIntent: () => intent,\n        terminate: doc => {\n          const eventName =\n            data && data.exposeIntentFrameRemoval\n              ? 'exposeFrameRemoval'\n              : 'done'\n          return terminate({\n            type: `intent-${intent._id}:${eventName}`,\n            document: doc\n          })\n        },\n        throw: error =>\n          terminate({\n            type: `intent-${intent._id}:error`,\n            error: errorSerializer.serialize(error)\n          }),\n        resizeClient: resizeClient,\n        cancel: cancel\n      }\n    })\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/intents/service.js","import { cozyFetchJSON } from './fetch'\n\nexport function count(cozy, workerType) {\n  return cozyFetchJSON(cozy, 'GET', `/jobs/queue/${workerType}`).then(\n    data => data.length\n  )\n}\n\nexport function queued(cozy, workerType) {\n  return cozyFetchJSON(cozy, 'GET', `/jobs/queue/${workerType}`)\n}\n\nexport function create(cozy, workerType, args, options) {\n  return cozyFetchJSON(cozy, 'POST', `/jobs/queue/${workerType}`, {\n    data: {\n      type: 'io.cozy.jobs',\n      attributes: {\n        arguments: args || {},\n        options: options || {}\n      }\n    }\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/jobs.js","/* global pouchdbAdapterCordovaSqlite */\nimport { DOCTYPE_FILES } from './doctypes'\nimport { refreshToken } from './auth_v3'\nimport { isOffline } from './utils'\nimport PouchDB from 'pouchdb'\nimport pouchdbFind from 'pouchdb-find'\n\nexport const replicationOfflineError =\n  'Replication abort, your device is actually offline.'\n\nlet pluginLoaded = false\n\n/*\n  For each doctype we have some parameters:\n  cozy._offline[doctype] = {\n    database: pouchdb database\n    replication: the pouchdb replication\n    replicationPromise: promise of replication\n    interval: repeated replication interval\n  }\n*/\n\nexport function init(cozy, { options = {}, doctypes = [] }) {\n  for (let doctype of doctypes) {\n    createDatabase(cozy, doctype, options)\n  }\n}\n\n// helper\n\nfunction getInfo(cozy, doctype) {\n  cozy._offline = cozy._offline || []\n  cozy._offline[doctype] = cozy._offline[doctype] || {}\n  return cozy._offline[doctype]\n}\n\nexport function getDoctypes(cozy) {\n  cozy._offline = cozy._offline || []\n  return Object.keys(cozy._offline)\n}\n\n//\n// DATABASE\n//\n\nexport function hasDatabase(cozy, doctype) {\n  return getDatabase(cozy, doctype) !== undefined\n}\n\nexport function getDatabase(cozy, doctype) {\n  return getInfo(cozy, doctype).database\n}\n\nexport function setDatabase(cozy, doctype, database) {\n  cozy._offline[doctype].database = database\n  return getDatabase(cozy, doctype)\n}\n\nexport function createDatabase(cozy, doctype, options = {}) {\n  if (!pluginLoaded) {\n    PouchDB.plugin(pouchdbFind)\n    if (typeof pouchdbAdapterCordovaSqlite !== 'undefined')\n      PouchDB.plugin(pouchdbAdapterCordovaSqlite)\n    pluginLoaded = true\n  }\n\n  if (hasDatabase(cozy, doctype)) {\n    return Promise.resolve(getDatabase(cozy, doctype))\n  }\n\n  setDatabase(cozy, doctype, new PouchDB(doctype, options))\n  return createIndexes(cozy, doctype).then(() => getDatabase(cozy, doctype))\n}\n\nexport function destroyDatabase(cozy, doctype) {\n  if (!hasDatabase(cozy, doctype)) {\n    return Promise.resolve(false)\n  }\n\n  return stopRepeatedReplication(cozy, doctype)\n    .then(() => stopReplication(cozy, doctype))\n    .then(() => getDatabase(cozy, doctype).destroy())\n    .then(response => {\n      setDatabase(cozy, doctype, undefined)\n      return response\n    })\n}\n\nexport function destroyAllDatabase(cozy) {\n  const doctypes = getDoctypes(cozy)\n  const destroy = doctype => destroyDatabase(cozy, doctype)\n  return Promise.all(doctypes.map(destroy))\n}\n\nfunction createIndexes(cozy, doctype) {\n  if (doctype === DOCTYPE_FILES) {\n    return getDatabase(cozy, doctype).createIndex({\n      index: { fields: ['dir_id'] }\n    })\n  }\n  return Promise.resolve()\n}\n\n//\n// REPLICATION\n//\n\nexport function hasReplication(cozy, doctype) {\n  return getReplication(cozy, doctype) !== undefined\n}\n\nfunction getReplication(cozy, doctype) {\n  return getInfo(cozy, doctype).replication\n}\n\nfunction setReplication(cozy, doctype, replication) {\n  cozy._offline[doctype].replication = replication\n  return getReplication(cozy, doctype)\n}\n\nfunction getReplicationUrl(cozy, doctype) {\n  return cozy.authorize().then(credentials => {\n    const basic = credentials.token.toBasicAuth()\n    return (cozy._url + '/data/' + doctype).replace('//', `//${basic}`)\n  })\n}\n\nfunction getReplicationPromise(cozy, doctype) {\n  return getInfo(cozy, doctype).replicationPromise\n}\n\nfunction setReplicationPromise(cozy, doctype, promise) {\n  cozy._offline[doctype].replicationPromise = promise\n  return getReplicationPromise(cozy, doctype)\n}\n\nexport function replicateFromCozy(cozy, doctype, options = {}) {\n  return setReplicationPromise(\n    cozy,\n    doctype,\n    new Promise((resolve, reject) => {\n      if (!hasDatabase(cozy, doctype)) {\n        createDatabase(cozy, doctype)\n      }\n      if (options.live === true) {\n        return reject(\n          new Error(\"You can't use `live` option with Cozy couchdb.\")\n        )\n      }\n\n      if (isOffline()) {\n        reject(replicationOfflineError)\n        options.onError && options.onError(replicationOfflineError)\n        return\n      }\n\n      getReplicationUrl(cozy, doctype).then(url =>\n        setReplication(\n          cozy,\n          doctype,\n          getDatabase(cozy, doctype)\n            .replicate.from(url, options)\n            .on('complete', info => {\n              setReplication(cozy, doctype, undefined)\n              resolve(info)\n              options.onComplete && options.onComplete(info)\n            })\n            .on('error', err => {\n              if (err.error === 'code=400, message=Expired token') {\n                cozy.authorize().then(({ client, token }) => {\n                  refreshToken(cozy, client, token)\n                    .then(newToken => cozy.saveCredentials(client, newToken))\n                    .then(() => replicateFromCozy(cozy, doctype, options))\n                })\n              } else {\n                console.warn(`ReplicateFromCozy '${doctype}' Error:`)\n                console.warn(err)\n                setReplication(cozy, doctype, undefined)\n                reject(err)\n                options.onError && options.onError(err)\n              }\n            })\n        )\n      )\n    })\n  )\n}\n\nexport function stopReplication(cozy, doctype) {\n  if (!getDatabase(cozy, doctype) || !hasReplication(cozy, doctype)) {\n    return Promise.resolve()\n  }\n\n  return new Promise(resolve => {\n    try {\n      getReplicationPromise(cozy, doctype).then(() => {\n        resolve()\n      })\n      getReplication(cozy, doctype).cancel()\n      // replication is set to undefined by complete replication\n    } catch (e) {\n      resolve()\n    }\n  })\n}\n\nexport function stopAllReplication(cozy) {\n  const doctypes = getDoctypes(cozy)\n  const stop = doctype => stopReplication(cozy, doctype)\n  return Promise.all(doctypes.map(stop))\n}\n\n//\n// REPEATED REPLICATION\n//\n\nfunction getRepeatedReplication(cozy, doctype) {\n  return getInfo(cozy, doctype).interval\n}\n\nfunction setRepeatedReplication(cozy, doctype, interval) {\n  cozy._offline[doctype].interval = interval\n}\n\nexport function hasRepeatedReplication(cozy, doctype) {\n  return getRepeatedReplication(cozy, doctype) !== undefined\n}\n\nexport function startRepeatedReplication(cozy, doctype, timer, options = {}) {\n  // TODO: add timer limitation for not flooding Gozy\n  if (hasRepeatedReplication(cozy, doctype)) {\n    return getRepeatedReplication(cozy, doctype)\n  }\n\n  return setRepeatedReplication(\n    cozy,\n    doctype,\n    setInterval(() => {\n      if (isOffline()) {\n        // network is offline, replication cannot be launched\n        console.info(replicationOfflineError)\n        return\n      }\n      if (!hasReplication(cozy, doctype)) {\n        replicateFromCozy(cozy, doctype, options)\n        // TODO: add replicationToCozy\n      }\n    }, timer * 1000)\n  )\n}\n\nexport function stopRepeatedReplication(cozy, doctype) {\n  if (hasRepeatedReplication(cozy, doctype)) {\n    clearInterval(getRepeatedReplication(cozy, doctype))\n    setRepeatedReplication(cozy, doctype, undefined)\n  }\n  if (hasReplication(cozy, doctype)) {\n    return stopReplication(cozy, doctype)\n  }\n\n  return Promise.resolve()\n}\n\nexport function stopAllRepeatedReplication(cozy) {\n  const doctypes = getDoctypes(cozy)\n  const stop = doctype => stopRepeatedReplication(cozy, doctype)\n  return Promise.all(doctypes.map(stop))\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/offline.js","module.exports = require(\"pouchdb\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pouchdb\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"pouchdb-find\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pouchdb-find\"\n// module id = 24\n// module chunks = 0","import { cozyFetchJSON } from './fetch'\n\nexport function diskUsage(cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/disk-usage`)\n}\n\nexport function changePassphrase(cozy, currentPassPhrase, newPassPhrase) {\n  return cozyFetchJSON(cozy, 'PUT', `/settings/passphrase`, {\n    current_passphrase: currentPassPhrase,\n    new_passphrase: newPassPhrase\n  })\n}\n\nexport function getInstance(cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/instance`)\n}\n\nexport function updateInstance(cozy, instance) {\n  return cozyFetchJSON(cozy, 'PUT', `/settings/instance`, instance)\n}\n\nexport function getClients(cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/clients`)\n}\n\nexport function deleteClientById(cozy, id) {\n  return cozyFetchJSON(cozy, 'DELETE', `/settings/clients/${id}`)\n}\n\nexport function updateLastSync(cozy) {\n  return cozyFetchJSON(cozy, 'POST', '/settings/synchronized')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/settings.js","import { cozyFetchJSON, cozyFetchRawJSON } from './fetch'\nimport { DOCTYPE_FILES } from './doctypes'\n\nfunction updateRelations(verb) {\n  return function(cozy, doc, ids) {\n    if (!doc) throw new Error('missing doc argument')\n    if (!Array.isArray(ids)) ids = [ids]\n\n    const refs = ids.map(id => ({ type: DOCTYPE_FILES, id }))\n\n    return cozyFetchJSON(cozy, verb, makeReferencesPath(doc), { data: refs })\n  }\n}\n\nexport const addReferencedFiles = updateRelations('POST')\nexport const removeReferencedFiles = updateRelations('DELETE')\n\nexport function listReferencedFiles(cozy, doc) {\n  if (!doc) throw new Error('missing doc argument')\n  return cozyFetchJSON(cozy, 'GET', makeReferencesPath(doc)).then(files =>\n    files.map(file => file._id)\n  )\n}\n\nexport function fetchReferencedFiles(cozy, doc, options) {\n  if (!doc) throw new Error('missing doc argument')\n  const params = Object.keys(options)\n    .map(key => `&page[${key}]=${options[key]}`)\n    .join('')\n  // As datetime is the only sort option available, I see no reason to not have it by default\n  return cozyFetchRawJSON(\n    cozy,\n    'GET',\n    `${makeReferencesPath(doc)}?include=files&sort=datetime${params}`\n  )\n}\n\nfunction makeReferencesPath(doc) {\n  const type = encodeURIComponent(doc._type)\n  const id = encodeURIComponent(doc._id)\n  return `/data/${type}/${id}/relationships/references`\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/relations.js"],"sourceRoot":""}