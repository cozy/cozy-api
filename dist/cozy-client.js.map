{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap d181d723e12b9bd3abd5","webpack:///./~/isomorphic-fetch/fetch-npm-browserify.js","webpack:///./~/whatwg-fetch/fetch.js","webpack:///./src/index.js","webpack:///./src/utils.js","webpack:///./src/auth_storage.js","webpack:///./src/auth_v2.js","webpack:///./src/auth_v3.js","webpack:///./src/fetch.js","webpack:///./src/jsonapi.js","webpack:///./src/doctypes.js","webpack:///./src/mango.js","webpack:///./src/files.js","webpack:///./src/offline.js","webpack:///external \"pouchdb\"","webpack:///external \"pouchdb-find\"","webpack:///./src/settings.js","webpack:///./src/relations.js","webpack:///./src/data.js"],"names":["auth","data","mango","files","offline","settings","relations","AppTokenV3","AppToken","AccessTokenV3","AccessToken","ClientV3","Client","AuthNone","AuthRunning","AuthError","AuthOK","defaultClientParams","softwareID","dataProto","create","find","update","delete","_delete","updateAttributes","changesFeed","defineIndex","query","addReferencedFiles","listReferencedFiles","destroy","authProto","registerClient","updateClient","unregisterClient","getClient","getAuthCodeURL","getAccessToken","refreshToken","filesProto","createDirectory","updateById","updateAttributesById","updateAttributesByPath","trashById","statById","statByPath","downloadById","downloadByPath","getDowloadLink","getArchiveLink","listTrash","clearTrash","restoreById","destroyById","offlineProto","init","getDoctypes","createDatabase","hasDatabase","getDatabase","destroyDatabase","replicateFromCozy","hasSync","startAllSync","startSync","stopAllSync","stopSync","settingsProto","diskUsage","options","AppTokenV2","LocalStorage","MemoryStorage","_inited","_oauth","_token","_authstate","_authcreds","_storage","_version","_offline","token","oauth","Error","storage","_clientParams","Object","assign","clientParams","_onRegistered","onRegistered","nopOnRegistered","url","cozyURL","length","slice","_url","disablePromises","addToProto","state","isV2","then","oauthFlow","Promise","resolve","client","creds","save","CredsKey","path","pathprefix","fetch","res","ok","json","status","datasystem","undefined","protoify","context","fn","prototyped","args","ctx","obj","proto","attr","module","exports","unpromiser","isPromise","sleep","retry","getFuzzedDelay","getBackedoffDelay","createPath","encodeQuery","decodeQuery","warn","FuzzFactor","value","apply","l","cb","err","time","setTimeout","count","delay","doTry","catch","retryDelay","fuzzingFactor","Math","random","retryCount","pow","cozy","doctype","id","route","encodeURIComponent","q","qname","queryIndex","indexOf","queries","fragIndex","queryStr","parts","split","i","pair","decodeURIComponent","hasOwnProperty","warned","text","push","console","prefix","window","localStorage","key","setItem","JSON","stringify","item","getItem","parse","removeItem","hash","deleted","getAppToken","V2TOKEN_ABORT_TIMEOUT","reject","parent","postMessage","origin","location","intent","action","timeout","receiver","event","appName","e","removeEventListener","clearTimeout","addEventListener","opts","btoa","StateSize","StateKey","clientID","client_id","clientSecret","client_secret","registrationAccessToken","registration_access_token","redirect_uris","redirectURI","software_id","softwareVersion","software_version","clientName","client_name","clientKind","client_kind","clientURI","client_uri","logoURI","logo_uri","policyURI","policy_uri","tokenType","token_type","accessToken","access_token","refresh_token","scope","isRegistered","toRegisterJSON","disableAuth","resetSecret","createClient","manualAuthCredentials","oldClient","newClient","shouldPassRegistration","scopes","generateRandomState","join","pageURL","grantQueries","getGrantCodeFromPageURL","retrieveToken","code","tryCount","clearAndRetry","clear","registerNewClient","all","load","credentials","storedState","isUnauthorized","statePromise","t","body","headers","href","buffer","crypto","getRandomValues","Uint8Array","require","randomBytes","Array","floor","String","fromCharCode","replace","cozyFetch","cozyFetchJSON","fullpath","resp","cozyFetchWithAuth","authorize","handleResponse","toAuthHeader","newToken","saveCredentials","method","handleJSONResponse","contentType","get","FetchError","reason","response","indexKey","doc","type","findByRef","resources","ref","handleResource","rawResource","links","resource","_id","_type","_rev","meta","rev","attributes","name","rels","relationships","isArray","map","handleTopLevel","included","forEach","r","normalizeDoctype","DOCTYPE_FILES","KNOWN_DOCTYPES","REVERSE_KNOWN","keys","k","isQualified","known","parseSelector","normalizeSelector","makeMapReduceQuery","fields","defineIndexV2","defineIndexV3","indexRef","queryV2","queryV3","VALUEOPERATORS","LOGICOPERATORS","MAP_TEMPLATE","docType","toLowerCase","emit","FIELDSPLACEHOLDER","toString","COUCHDB_INFINITY","COUCHDB_LOWEST","indexName","capitalize","indexDefinition","makeMapFunction","reduce","use_index","selector","limit","since","descending","sort","f","docs","charAt","toUpperCase","operator","acc","concat","filters","filter","op","field","applySelector","lower","upper","inclusiveEnd","startkey","endkey","inclusive_end","mrquery","firstFreeValueField","normalizedSelector","used","isFreeValue","contentTypeOctetStream","doUpload","ArrayBuffer","isBuffer","isFile","File","isBlob","Blob","isStream","readable","pipe","isString","checksum","lastModifiedDate","ifMatch","Date","toGMTString","dirID","doUpdateAttributes","attrs","db","children","addIsDir","toJsonApi","extractResponseLinkRelated","related","paths","archive","isDir","contents","clone","replicateFromCozyWithAuth","pluginLoaded","doctypes","timer","plugin","database","autoSync","createIndexes","setInterval","replicate","on","info","replication","cancel","clearInterval","events","live","basic","toBasicAuth","from","eventNames","eventName","createIndex","index","ids","refs","makeReferencesPath","file","NOREV","changes","tries"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACLA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,QAAO;;AAEP,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yCAAwC,mBAAmB;AAC3D;AACA;;AAEA;AACA;AACA,mCAAkC,oBAAoB;AACtD;AACA;;AAEA;AACA;AACA,yCAAwC,4BAA4B;AACpE;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,oBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA,wDAAuD;AACvD,UAAS;AACT;AACA,UAAS;AACT,+EAA8E;AAC9E;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,+BAA8B,uBAAuB;AACrD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA,wCAAuC,0BAA0B;AACjE;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,gCAA+B,0BAA0B,eAAe;AACxE;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA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","file":"cozy-client.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"pouchdb\"), require(\"pouchdb-find\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cozy-client-js\", [\"pouchdb\", \"pouchdb-find\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cozy-client-js\"] = factory(require(\"pouchdb\"), require(\"pouchdb-find\"));\n\telse\n\t\troot[\"cozy-client-js\"] = factory(root[\"pouchdb\"], root[\"pouchdb-find\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_15__, __WEBPACK_EXTERNAL_MODULE_16__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d181d723e12b9bd3abd5","// the whatwg-fetch polyfill installs the fetch() function\n// on the global object (window or self)\n//\n// Return that as the export for use in Webpack, Browserify etc.\nrequire('whatwg-fetch');\nmodule.exports = self.fetch.bind(self);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/isomorphic-fetch/fetch-npm-browserify.js\n// module id = 1\n// module chunks = 0","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ]\n\n    var isDataView = function(obj) {\n      return obj && DataView.prototype.isPrototypeOf(obj)\n    }\n\n    var isArrayBufferView = ArrayBuffer.isView || function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var oldValue = this.map[name]\n    this.map[name] = oldValue ? oldValue+','+value : value\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name)\n    return this.has(name) ? this.map[name] : null\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value)\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this)\n      }\n    }\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsArrayBuffer(blob)\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsText(blob)\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf)\n    var chars = new Array(view.length)\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i])\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength)\n      view.set(new Uint8Array(buf))\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (!body) {\n        this._bodyText = ''\n      } else if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer)\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer])\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body)\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      }\n    }\n\n    this.text = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n\n    if (typeof input === 'string') {\n      this.url = input\n    } else {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, { body: this._bodyInit })\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers()\n    rawHeaders.split('\\r\\n').forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        headers.append(key, value)\n      }\n    })\n    return headers\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = 'status' in options ? options.status : 200\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = 'statusText' in options ? options.statusText : 'OK'\n    this.headers = new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init)\n      var xhr = new XMLHttpRequest()\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        }\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/whatwg-fetch/fetch.js\n// module id = 2\n// module chunks = 0","/* global fetch */\n\nimport {unpromiser, retry, warn} from './utils'\nimport {LocalStorage, MemoryStorage} from './auth_storage'\nimport {AppToken as AppTokenV2, getAppToken as getAppTokenV2} from './auth_v2'\nimport * as auth from './auth_v3'\nimport * as data from './data'\nimport * as mango from './mango'\nimport * as files from './files'\nimport * as offline from './offline'\nimport * as settings from './settings'\nimport * as relations from './relations'\n\nconst {\n  AppToken: AppTokenV3,\n  AccessToken: AccessTokenV3,\n  Client: ClientV3\n} = auth\n\nconst AuthNone = 0\nconst AuthRunning = 1\nconst AuthError = 2\nconst AuthOK = 3\n\nconst defaultClientParams = {\n  softwareID: 'github.com/cozy/cozy-client-js'\n}\n\nconst dataProto = {\n  create: data.create,\n  find: data.find,\n  update: data.update,\n  delete: data._delete,\n  updateAttributes: data.updateAttributes,\n  changesFeed: data.changesFeed,\n  defineIndex: mango.defineIndex,\n  query: mango.query,\n  addReferencedFiles: relations.addReferencedFiles,\n  listReferencedFiles: relations.listReferencedFiles,\n  destroy: function (...args) {\n    warn('destroy is deprecated, use cozy.data.delete instead.')\n    return data._delete(...args)\n  }\n}\n\nconst authProto = {\n  registerClient: auth.registerClient,\n  updateClient: auth.updateClient,\n  unregisterClient: auth.unregisterClient,\n  getClient: auth.getClient,\n  getAuthCodeURL: auth.getAuthCodeURL,\n  getAccessToken: auth.getAccessToken,\n  refreshToken: auth.refreshToken\n}\n\nconst filesProto = {\n  create: files.create,\n  createDirectory: files.createDirectory,\n  updateById: files.updateById,\n  updateAttributesById: files.updateAttributesById,\n  updateAttributesByPath: files.updateAttributesByPath,\n  trashById: files.trashById,\n  statById: files.statById,\n  statByPath: files.statByPath,\n  downloadById: files.downloadById,\n  downloadByPath: files.downloadByPath,\n  getDowloadLink: files.getDowloadLink,\n  getArchiveLink: files.getArchiveLink,\n  listTrash: files.listTrash,\n  clearTrash: files.clearTrash,\n  restoreById: files.restoreById,\n  destroyById: files.destroyById\n}\n\nconst offlineProto = {\n  init: offline.init,\n  getDoctypes: offline.getDoctypes,\n  // database\n  createDatabase: offline.createDatabase,\n  hasDatabase: offline.hasDatabase,\n  getDatabase: offline.getDatabase,\n  destroyDatabase: offline.destroyDatabase,\n  // replication\n  replicateFromCozy: offline.replicateFromCozy,\n  hasSync: offline.hasSync,\n  startAllSync: offline.startAllSync,\n  startSync: offline.startSync,\n  stopAllSync: offline.stopAllSync,\n  stopSync: offline.stopSync\n}\n\nconst settingsProto = {\n  diskUsage: settings.diskUsage\n}\n\nclass Client {\n  constructor (options) {\n    this.data = {}\n    this.files = {}\n    this.offline = {}\n    this.settings = {}\n    this.auth = {\n      Client: ClientV3,\n      AccessToken: AccessTokenV3,\n      AppToken: AppTokenV3,\n      AppTokenV2: AppTokenV2,\n      LocalStorage: LocalStorage,\n      MemoryStorage: MemoryStorage\n    }\n    this._inited = false\n    if (options) {\n      this.init(options)\n    }\n  }\n\n  init (options = {}) {\n    this._inited = true\n    this._oauth = false // is oauth activated or not\n    this._token = null  // application token\n    this._authstate = AuthNone\n    this._authcreds = null\n    this._storage = null\n    this._version = null\n    this._offline = null\n\n    const token = options.token\n    const oauth = options.oauth\n    if (token && oauth) {\n      throw new Error('Cannot specify an application token with a oauth activated')\n    }\n\n    if (token) {\n      this._token = new AppTokenV3({ token })\n    } else if (oauth) {\n      this._oauth = true\n      this._storage = oauth.storage\n      this._clientParams = Object.assign({}, defaultClientParams, oauth.clientParams)\n      this._onRegistered = oauth.onRegistered || nopOnRegistered\n    }\n\n    let url = options.cozyURL || ''\n    while (url[url.length - 1] === '/') {\n      url = url.slice(0, -1)\n    }\n\n    this._url = url\n\n    const disablePromises = !!options.disablePromises\n    addToProto(this, this.data, dataProto, disablePromises)\n    addToProto(this, this.auth, authProto, disablePromises)\n    addToProto(this, this.files, filesProto, disablePromises)\n    addToProto(this, this.offline, offlineProto, disablePromises)\n    addToProto(this, this.settings, settingsProto, disablePromises)\n\n    if (options.offline) {\n      this.offline.init(options.offline)\n    }\n  }\n\n  authorize () {\n    const state = this._authstate\n    if (state === AuthOK || state === AuthRunning) {\n      return this._authcreds\n    }\n\n    this._authstate = AuthRunning\n    this._authcreds = this.isV2().then((isV2) => {\n      if (isV2 && this._oauth) {\n        throw new Error('OAuth is not supported on the V2 stack')\n      }\n      if (this._oauth) {\n        return auth.oauthFlow(\n          this,\n          this._storage,\n          this._clientParams,\n          this._onRegistered\n        )\n      }\n      // we expect to be on a client side application running in a browser\n      // with cookie-based authentication.\n      if (isV2) {\n        return getAppTokenV2()\n      } else if (this._token) {\n        return Promise.resolve({client: null, token: this._token})\n      } else {\n        throw new Error('Missing application token')\n      }\n    })\n\n    this._authcreds.then(\n      () => { this._authstate = AuthOK },\n      () => { this._authstate = AuthError })\n\n    return this._authcreds\n  }\n\n  saveCredentials (client, token) {\n    const creds = {client, token}\n    if (!this._storage || this._authstate === AuthRunning) {\n      return Promise.resolve(creds)\n    }\n    this._storage.save(auth.CredsKey, creds)\n    this._authcreds = Promise.resolve(creds)\n    return this._authcreds\n  }\n\n  fullpath (path) {\n    return this.isV2().then((isV2) => {\n      const pathprefix = isV2 ? '/ds-api' : ''\n      return this._url + pathprefix + path\n    })\n  }\n\n  isV2 () {\n    if (!this._version) {\n      this._version = retry(() => fetch(`${this._url}/status/`), 3)()\n        .then((res) => {\n          if (!res.ok) {\n            throw new Error('Could not fetch cozy status')\n          } else {\n            return res.json()\n          }\n        })\n        .then((status) => status.datasystem !== undefined)\n    }\n    return this._version\n  }\n}\n\nfunction nopOnRegistered () {\n  throw new Error('Missing onRegistered callback')\n}\n\nfunction protoify (context, fn) {\n  return function prototyped (...args) {\n    return fn(context, ...args)\n  }\n}\n\nfunction addToProto (ctx, obj, proto, disablePromises) {\n  for (const attr in proto) {\n    let fn = protoify(ctx, proto[attr])\n    if (disablePromises) {\n      fn = unpromiser(fn)\n    }\n    obj[attr] = fn\n  }\n}\n\nmodule.exports = new Client()\nObject.assign(module.exports, {Client, LocalStorage, MemoryStorage})\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const FuzzFactor = 0.3\n\nexport function unpromiser (fn) {\n  return function (...args) {\n    const value = fn.apply(this, args)\n    if (!isPromise(value)) {\n      return value\n    }\n    const l = args.length\n    if (l === 0 || typeof args[l - 1] !== 'function') {\n      return\n    }\n    const cb = args[l - 1]\n    value.then(\n      (res) => cb(null, res),\n      (err) => cb(err, null)\n    )\n    return\n  }\n}\n\nexport function isPromise (value) {\n  return !!value && typeof value.then === 'function'\n}\n\nexport function sleep (time, args) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, time, args)\n  })\n}\n\nexport function retry (fn, count, delay = 300) {\n  return function doTry (...args) {\n    return fn(...args).catch((err) => {\n      if (--count < 0) {\n        throw err\n      }\n      return sleep(getBackedoffDelay(delay, count))\n        .then(() => doTry(...args))\n    })\n  }\n}\n\nexport function getFuzzedDelay (retryDelay) {\n  const fuzzingFactor = ((Math.random() * 2) - 1) * FuzzFactor\n  return retryDelay * (1.0 + fuzzingFactor)\n}\n\nexport function getBackedoffDelay (retryDelay, retryCount = 1) {\n  return getFuzzedDelay(retryDelay * Math.pow(2, retryCount - 1))\n}\n\nexport function createPath (cozy, isV2, doctype, id = '', query = null) {\n  let route = '/data/'\n  if (!isV2) {\n    route += `${encodeURIComponent(doctype)}/`\n  }\n  if (id !== '') {\n    route += encodeURIComponent(id)\n  }\n  const q = encodeQuery(query)\n  if (q !== '') {\n    route += '?' + q\n  }\n  return route\n}\n\nexport function encodeQuery (query) {\n  if (!query) {\n    return ''\n  }\n  let q = ''\n  for (const qname in query) {\n    if (q !== '') {\n      q += '&'\n    }\n    q += `${encodeURIComponent(qname)}=${encodeURIComponent(query[qname])}`\n  }\n  return q\n}\n\nexport function decodeQuery (url) {\n  let queryIndex = url.indexOf('?')\n  if (queryIndex < 0) {\n    queryIndex = url.length\n  }\n  const queries = {}\n  let fragIndex = url.indexOf('#')\n  if (fragIndex < 0) {\n    fragIndex = url.length\n  }\n  if (fragIndex < queryIndex) {\n    return queries\n  }\n  const queryStr = url.slice(queryIndex + 1, fragIndex)\n  if (queryStr === '') {\n    return queries\n  }\n  const parts = queryStr.split('&')\n  for (let i = 0; i < parts.length; i++) {\n    let pair = parts[i].split('=')\n    if (pair.length === 0 || pair[0] === '') {\n      continue\n    }\n    const qname = decodeURIComponent(pair[0])\n    if (queries.hasOwnProperty(qname)) {\n      continue\n    }\n    if (pair.length === 1) {\n      queries[qname] = true\n    } else if (pair.length === 2) {\n      queries[qname] = decodeURIComponent(pair[1])\n    } else {\n      throw new Error('Malformed URL')\n    }\n  }\n  return queries\n}\n\nconst warned = []\nexport function warn (text) {\n  if (warned.indexOf(text) === -1) {\n    warned.push(text)\n    console.warn('cozy-client-js', text)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","export class LocalStorage {\n  constructor (storage, prefix) {\n    if (!storage && typeof window !== 'undefined') {\n      storage = window.localStorage\n    }\n    this.storage = storage\n    this.prefix = prefix || 'cozy:oauth:'\n  }\n\n  save (key, value) {\n    return new Promise(resolve => {\n      this.storage.setItem(this.prefix + key, JSON.stringify(value))\n      resolve(value)\n    })\n  }\n\n  load (key) {\n    return new Promise(resolve => {\n      const item = this.storage.getItem(this.prefix + key)\n      if (!item) {\n        resolve()\n      } else {\n        resolve(JSON.parse(item))\n      }\n    })\n  }\n\n  delete (key) {\n    return new Promise(resolve => resolve(\n      this.storage.removeItem(this.prefix + key)))\n  }\n\n  clear () {\n    return new Promise(resolve => {\n      const storage = this.storage\n      for (let i = 0; i < storage.length; i++) {\n        const key = storage.key(i)\n        if (key.indexOf(this.prefix) === 0) {\n          storage.removeItem(key)\n        }\n      }\n      resolve()\n    })\n  }\n}\n\nexport class MemoryStorage {\n  constructor () {\n    this.hash = Object.create(null)\n  }\n\n  save (key, value) {\n    this.hash[key] = value\n    return Promise.resolve(value)\n  }\n\n  load (key) {\n    return Promise.resolve(this.hash[key])\n  }\n\n  delete (key) {\n    const deleted = delete this.hash[key]\n    return Promise.resolve(deleted)\n  }\n\n  clear () {\n    this.hash = Object.create(null)\n    return Promise.resolve()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_storage.js","/* global btoa */\nconst V2TOKEN_ABORT_TIMEOUT = 3000\n\nexport function getAppToken () {\n  return new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined') {\n      return reject(new Error('getV2Token should be used in browser'))\n    } else if (!window.parent) {\n      return reject(new Error('getV2Token should be used in iframe'))\n    } else if (!window.parent.postMessage) {\n      return reject(new Error('getV2Token should be used in modern browser'))\n    }\n    const origin = window.location.origin\n    const intent = {action: 'getToken'}\n    let timeout = null\n    const receiver = function (event) {\n      let token\n      try {\n        token = new AppToken({\n          appName: event.data.appName,\n          token: event.data.token\n        })\n      } catch (e) {\n        reject(e)\n        return\n      }\n      window.removeEventListener('message', receiver)\n      clearTimeout(timeout)\n      resolve({ client: null, token })\n    }\n    window.addEventListener('message', receiver, false)\n    window.parent.postMessage(intent, origin)\n    timeout = setTimeout(() => {\n      reject(new Error('No response from parent iframe after 3s'))\n    }, V2TOKEN_ABORT_TIMEOUT)\n  })\n}\n\nexport class AppToken {\n  constructor (opts) {\n    this.appName = opts.appName || ''\n    this.token = opts.token || ''\n  }\n\n  toAuthHeader () {\n    return 'Basic ' + btoa(`${this.appName}:${this.token}`)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_v2.js","/* global btoa */\nimport {encodeQuery, decodeQuery} from './utils'\nimport {cozyFetchJSON, FetchError} from './fetch'\n\nconst StateSize = 16\n\nexport const CredsKey = 'creds'\nexport const StateKey = 'state'\n\nexport class Client {\n  constructor (opts) {\n    this.clientID = opts.clientID || opts.client_id || ''\n    this.clientSecret = opts.clientSecret || opts.client_secret || ''\n    this.registrationAccessToken = opts.registrationAccessToken || opts.registration_access_token || ''\n\n    if (opts.redirect_uris) {\n      this.redirectURI = opts.redirect_uris[0] || ''\n    } else {\n      this.redirectURI = opts.redirectURI || ''\n    }\n\n    this.softwareID = opts.softwareID || opts.software_id || ''\n    this.softwareVersion = opts.softwareVersion || opts.software_version || ''\n    this.clientName = opts.clientName || opts.client_name || ''\n    this.clientKind = opts.clientKind || opts.client_kind || ''\n    this.clientURI = opts.clientURI || opts.client_uri || ''\n\n    this.logoURI = opts.logoURI || opts.logo_uri || ''\n    this.policyURI = opts.policyURI || opts.policy_uri || ''\n\n    if (!this.registrationAccessToken) {\n      if (this.redirectURI === '') {\n        throw new Error('Missing redirectURI field')\n      }\n      if (this.softwareID === '') {\n        throw new Error('Missing softwareID field')\n      }\n      if (this.clientName === '') {\n        throw new Error('Missing clientName field')\n      }\n    }\n  }\n\n  isRegistered () {\n    return this.clientID !== ''\n  }\n\n  toRegisterJSON () {\n    return {\n      redirect_uris: [this.redirectURI],\n      software_id: this.softwareID,\n      software_version: this.softwareVersion,\n      client_name: this.clientName,\n      client_kind: this.clientKind,\n      client_uri: this.clientURI,\n      logo_uri: this.logoURI,\n      policy_uri: this.policyURI\n    }\n  }\n\n  toAuthHeader () {\n    return 'Bearer ' + this.registrationAccessToken\n  }\n}\n\nexport class AccessToken {\n  constructor (opts) {\n    this.tokenType = opts.tokenType || opts.token_type\n    this.accessToken = opts.accessToken || opts.access_token\n    this.refreshToken = opts.refreshToken || opts.refresh_token\n    this.scope = opts.scope\n  }\n\n  toAuthHeader () {\n    return 'Bearer ' + this.accessToken\n  }\n\n  toBasicAuth () {\n    return `user:${this.accessToken}@`\n  }\n}\n\nexport class AppToken {\n  constructor (opts) {\n    this.token = opts.token || ''\n  }\n\n  toAuthHeader () {\n    return 'Bearer ' + this.token\n  }\n\n  toBasicAuth () {\n    return `user:${this.token}@`\n  }\n}\n\nexport function registerClient (cozy, client) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (client.isRegistered()) {\n    return Promise.reject(new Error('Client already registered'))\n  }\n  return cozyFetchJSON(cozy, 'POST', '/auth/register', client.toRegisterJSON(), {\n    disableAuth: true\n  })\n    .then((data) => new Client(data))\n}\n\nexport function updateClient (cozy, client, resetSecret = false) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  let data = client.toRegisterJSON()\n  data.client_id = client.clientID\n  if (resetSecret) data.client_secret = client.clientSecret\n\n  return cozyFetchJSON(cozy, 'PUT', `/auth/register/${client.clientID}`, data)\n    .then((data) => createClient(data, client))\n}\n\nexport function unregisterClient (cozy, client) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  return cozyFetchJSON(cozy, 'DELETE', `/auth/register/${client.clientID}`, null, {\n    manualAuthCredentials: {\n      client: client,\n      token: client\n    }\n  })\n}\n\n// getClient will retrive the registered client informations from the server.\nexport function getClient (cozy, client) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  return cozyFetchJSON(cozy, 'GET', `/auth/register/${client.clientID}`, null, {\n    manualAuthCredentials: {\n      client: client,\n      token: client\n    }\n  })\n    .then((data) => createClient(data, client))\n}\n\n// createClient returns a new Client instance given on object containing the\n// data of the client, from the API, and an old instance of the client.\nfunction createClient (data, oldClient) {\n  const newClient = new Client(data)\n  // we need to keep track of the registrationAccessToken since it is send\n  // only on registration. The GET /auth/register/:client-id endpoint does\n  // not return this token.\n  const shouldPassRegistration = (\n    !!oldClient &&\n    oldClient.registrationAccessToken !== '' &&\n    newClient.registrationAccessToken === ''\n  )\n  if (shouldPassRegistration) {\n    newClient.registrationAccessToken = oldClient.registrationAccessToken\n  }\n  return newClient\n}\n\n// getAuthCodeURL returns a pair {authURL,state} given a registered client. The\n// state should be stored in order to be checked against on the user validation\n// phase.\nexport function getAuthCodeURL (cozy, client, scopes = []) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    throw new Error('Client not registered')\n  }\n  const state = generateRandomState()\n  const query = {\n    'client_id': client.clientID,\n    'redirect_uri': client.redirectURI,\n    'state': state,\n    'response_type': 'code',\n    'scope': scopes.join(' ')\n  }\n  return {\n    url: cozy._url + `/auth/authorize?${encodeQuery(query)}`,\n    state: state\n  }\n}\n\n// getAccessToken perform a request on the access_token entrypoint with the\n// authorization_code grant type in order to generate a new access token for a\n// newly registered client.\n//\n// This method extracts the access code and state from the given URL. By\n// default it uses window.location.href. Also, it checks the given state with\n// the one specified in the URL query parameter to prevent CSRF attacks.\nexport function getAccessToken (cozy, client, state, pageURL = '') {\n  if (!state) {\n    return Promise.reject(new Error('Missing state value'))\n  }\n  const grantQueries = getGrantCodeFromPageURL(pageURL)\n  if (grantQueries === null) {\n    return Promise.reject(new Error('Missing states from current URL'))\n  }\n  if (state !== grantQueries.state) {\n    return Promise.reject(new Error('Given state does not match url query state'))\n  }\n  return retrieveToken(cozy, client, null, {\n    'grant_type': 'authorization_code',\n    'code': grantQueries.code\n  })\n}\n\n// refreshToken perform a request on the access_token entrypoint with the\n// refresh_token grant type in order to refresh the given token.\nexport function refreshToken (cozy, client, token) {\n  return retrieveToken(cozy, client, token, {\n    'grant_type': 'refresh_token',\n    'code': token.refreshToken\n  })\n}\n\n// oauthFlow performs the stateful registration and access granting of an OAuth\n// client.\nexport function oauthFlow (cozy, storage, clientParams, onRegistered) {\n  let tryCount = 0\n\n  function clearAndRetry (err) {\n    if (tryCount++ > 0) {\n      throw err\n    }\n    return storage.clear().then(() =>\n      oauthFlow(cozy, storage, clientParams, onRegistered))\n  }\n\n  function registerNewClient () {\n    return storage.clear()\n      .then(() => registerClient(cozy, clientParams))\n      .then((client) => {\n        const {url, state} = getAuthCodeURL(cozy, client, clientParams.scopes)\n        return storage.save(StateKey, {client, url, state})\n      })\n  }\n\n  return Promise.all([\n    storage.load(CredsKey),\n    storage.load(StateKey)\n  ])\n  .then(([credentials, storedState]) => {\n    // If credentials are cached we re-fetch the registered client with the\n    // said token. Fetching the client, if the token is outdated we should try\n    // the token is refreshed.\n    if (credentials) {\n      let oldClient, token\n      try {\n        oldClient = new Client(credentials.client)\n        token = new AccessToken(credentials.token)\n      } catch (err) {\n        // bad cache, we should clear and retry the process\n        return clearAndRetry(err)\n      }\n      return getClient(cozy, oldClient)\n        .then((client) => ({client, token}))\n        .catch((err) => {\n          // If we fall into an error while fetching the client (because of a\n          // bad connectivity for instance), we do not bail the whole process\n          // since the client should be able to continue with the persisted\n          // client and token.\n          //\n          // If it is an explicit Unauthorized error though, we bail, clear th\n          // cache and retry.\n          if (FetchError.isUnauthorized(err)) {\n            throw err\n          }\n          return { client: oldClient, token }\n        })\n    }\n\n    // Otherwise register a new client if necessary (ie. no client is stored)\n    // and call the onRegistered callback to wait for the user to grant the\n    // access. Finally fetches to access token on success.\n    let statePromise\n    if (!storedState) {\n      statePromise = registerNewClient()\n    } else {\n      statePromise = Promise.resolve(storedState)\n    }\n\n    let client, state, token\n    return statePromise\n      .then((data) => {\n        client = data.client\n        state = data.state\n        return Promise.resolve(onRegistered(client, data.url))\n      })\n      .then((pageURL) => getAccessToken(cozy, client, state, pageURL))\n      .then((t) => { token = t })\n      .then(() => storage.delete(StateKey))\n      .then(() => ({client, token}))\n  })\n  .then(\n    (creds) => storage.save(CredsKey, creds),\n    (err) => {\n      if (FetchError.isUnauthorized(err)) {\n        return clearAndRetry(err)\n      } else {\n        throw err\n      }\n    })\n}\n\n// retrieveToken perform a request on the access_token entrypoint in order to\n// fetch a token.\nfunction retrieveToken (cozy, client, token, query) {\n  if (!(client instanceof Client)) {\n    client = new Client(client)\n  }\n  if (!client.isRegistered()) {\n    return Promise.reject(new Error('Client not registered'))\n  }\n  const body = encodeQuery(Object.assign({}, query, {\n    'client_id': client.clientID,\n    'client_secret': client.clientSecret\n  }))\n  return cozyFetchJSON(cozy, 'POST', '/auth/access_token', body, {\n    disableAuth: (token === null),\n    manualAuthCredentials: { client, token },\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }\n  })\n    .then((data) => new AccessToken(data))\n}\n\n// getGrantCodeFromPageURL extract the state and access_code query parameters\n// from the given url\nfunction getGrantCodeFromPageURL (pageURL = '') {\n  if (pageURL === '' && typeof window !== 'undefined') {\n    pageURL = window.location.href\n  }\n  const queries = decodeQuery(pageURL)\n  if (!queries.hasOwnProperty('state')) {\n    return null\n  }\n  return {\n    state: queries['state'],\n    code: queries['access_code']\n  }\n}\n\n// generateRandomState will try to generate a 128bits random value from a secure\n// pseudo random generator. It will fallback on Math.random if it cannot find\n// such generator.\nfunction generateRandomState () {\n  let buffer\n  if (typeof window !== 'undefined' &&\n      typeof window.crypto !== 'undefined' &&\n      typeof window.crypto.getRandomValues === 'function') {\n    buffer = new Uint8Array(StateSize)\n    window.crypto.getRandomValues(buffer)\n  } else {\n    try {\n      buffer = require('crypto').randomBytes(StateSize)\n    } catch (e) {}\n  }\n  if (!buffer) {\n    buffer = new Array(StateSize)\n    for (let i = 0; i < buffer.length; i++) {\n      buffer[i] = Math.floor((Math.random() * 255))\n    }\n  }\n  return btoa(String.fromCharCode.apply(null, buffer))\n    .replace(/=+$/, '')\n    .replace(/\\//g, '_')\n    .replace(/\\+/g, '-')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth_v3.js","/* global fetch */\nimport {refreshToken, AccessToken} from './auth_v3'\nimport {retry} from './utils'\nimport jsonapi from './jsonapi'\n\nexport function cozyFetch (cozy, path, options = {}) {\n  return cozy.fullpath(path).then((fullpath) => {\n    let resp\n    if (options.disableAuth) {\n      resp = fetch(fullpath, options)\n    } else if (options.manualAuthCredentials) {\n      resp = cozyFetchWithAuth(cozy, fullpath, options, options.manualAuthCredentials)\n    } else {\n      resp = cozy.authorize().then((credentials) =>\n        cozyFetchWithAuth(cozy, fullpath, options, credentials))\n    }\n    return resp.then(handleResponse)\n  })\n}\n\nfunction cozyFetchWithAuth (cozy, fullpath, options, credentials) {\n  if (credentials) {\n    options.headers = options.headers || {}\n    options.headers['Authorization'] = credentials.token.toAuthHeader()\n  }\n\n  // the option credentials:include tells fetch to include the cookies in the\n  // request even for cross-origin requests\n  options.credentials = 'include'\n\n  return Promise.all([\n    cozy.isV2(),\n    fetch(fullpath, options)\n  ]).then(([isV2, res]) => {\n    if (res.status !== 401 || isV2 || !credentials) {\n      return res\n    }\n    // we try to refresh the token only for OAuth, ie, the client defined\n    // and the token is an instance of AccessToken.\n    const { client, token } = credentials\n    if (!client || !(token instanceof AccessToken)) {\n      return res\n    }\n    return retry(() => refreshToken(cozy, client, token), 3)()\n      .then((newToken) => cozy.saveCredentials(client, newToken))\n      .then((credentials) => cozyFetchWithAuth(cozy, fullpath, options, credentials))\n  })\n}\n\nexport function cozyFetchJSON (cozy, method, path, body, options = {}) {\n  options.method = method\n\n  const headers = options.headers = options.headers || {}\n\n  headers['Accept'] = 'application/json'\n\n  if (method !== 'GET' && method !== 'HEAD' && body !== undefined) {\n    if (headers['Content-Type']) {\n      options.body = body\n    } else {\n      headers['Content-Type'] = 'application/json'\n      options.body = JSON.stringify(body)\n    }\n  }\n\n  return cozyFetch(cozy, path, options)\n    .then(handleJSONResponse)\n}\n\nfunction handleResponse (res) {\n  if (res.ok) {\n    return res\n  }\n  let data\n  const contentType = res.headers.get('content-type')\n  if (contentType && contentType.indexOf('json') >= 0) {\n    data = res.json()\n  } else {\n    data = res.text()\n  }\n  return data.then(err => {\n    throw new FetchError(res, err)\n  })\n}\n\nfunction handleJSONResponse (res) {\n  const contentType = res.headers.get('content-type')\n  if (!contentType || contentType.indexOf('json') < 0) {\n    return res.text((data) => {\n      throw new FetchError(res, new Error('Response is not JSON: ' + data))\n    })\n  }\n\n  const json = res.json()\n  if (contentType.indexOf('application/vnd.api+json') === 0) {\n    return json.then(jsonapi)\n  } else {\n    return json\n  }\n}\n\nexport class FetchError {\n  constructor (res, reason) {\n    this.response = res\n    this.url = res.url\n    this.status = res.status\n    this.reason = reason\n  }\n\n  isUnauthorized () {\n    return this.status === 401\n  }\n}\n\nFetchError.isUnauthorized = function (err) {\n  return (err instanceof FetchError && err.isUnauthorized())\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/fetch.js","function indexKey (doc) {\n  return doc.type + '/' + doc.id\n}\n\nfunction findByRef (resources, ref) {\n  return resources[indexKey(ref)]\n}\n\nfunction handleResource (rawResource, resources, links) {\n  let resource = {\n    _id: rawResource.id,\n    _type: rawResource.type,\n    _rev: (rawResource.meta && rawResource.meta.rev),\n    links: Object.assign({}, rawResource.links, links),\n    attributes: rawResource.attributes,\n    relations: (name) => {\n      let rels = rawResource.relationships[name]\n      if (rels === undefined || rels.data === undefined) return undefined\n      if (rels.data === null) return null\n      if (!Array.isArray(rels.data)) return findByRef(resources, rels.data)\n      return rels.data.map(ref => findByRef(resources, ref))\n    }\n  }\n\n  resources[indexKey(rawResource)] = resource\n\n  return resource\n}\n\nfunction handleTopLevel (doc, resources = {}) {\n  // build an index of included resource by Type & ID\n  const included = doc.included\n\n  if (Array.isArray(included)) {\n    included.forEach((r) => handleResource(r, resources, doc.links))\n  }\n\n  if (Array.isArray(doc.data)) {\n    return doc.data.map((r) => handleResource(r, resources, doc.links))\n  } else {\n    return handleResource(doc.data, resources, doc.links)\n  }\n}\n\nexport default handleTopLevel\n\n\n\n// WEBPACK FOOTER //\n// ./src/jsonapi.js","import {warn} from './utils'\n\nexport const DOCTYPE_FILES = 'io.cozy.files'\n\nconst KNOWN_DOCTYPES = {\n  'files': DOCTYPE_FILES,\n  'folder': DOCTYPE_FILES,\n  'contact': 'io.cozy.contacts',\n  'event': 'io.cozy.events',\n  'track': 'io.cozy.labs.music.track',\n  'playlist': 'io.cozy.labs.music.playlist'\n}\n\nconst REVERSE_KNOWN = {}\nObject.keys(KNOWN_DOCTYPES).forEach(k => {\n  REVERSE_KNOWN[KNOWN_DOCTYPES[k]] = k\n})\n\nexport function normalizeDoctype (cozy, isV2, doctype) {\n  let isQualified = doctype.indexOf('.') !== -1\n  if (isV2 && isQualified) {\n    let known = REVERSE_KNOWN[doctype]\n    if (known) return known\n    return doctype.replace(/\\./g, '-')\n  }\n  if (!isV2 && !isQualified) {\n    let known = KNOWN_DOCTYPES[doctype]\n    if (known) {\n      warn('you are using a non-qualified doctype ' + doctype + ' assumed to be ' + known)\n      return known\n    }\n    throw new Error('Doctype ' + doctype + ' should be qualified.')\n  }\n  return doctype\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/doctypes.js","import {warn, createPath} from './utils'\nimport {normalizeDoctype} from './doctypes'\nimport {cozyFetchJSON} from './fetch'\n\nexport function defineIndex (cozy, doctype, fields) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    if (!Array.isArray(fields) || fields.length === 0) {\n      throw new Error('defineIndex fields should be a non-empty array')\n    }\n    if (isV2) {\n      return defineIndexV2(cozy, doctype, fields)\n    } else {\n      return defineIndexV3(cozy, doctype, fields)\n    }\n  })\n}\n\nexport function query (cozy, indexRef, options) {\n  return cozy.isV2().then((isV2) => {\n    if (!indexRef) {\n      throw new Error('query should be passed the indexRef')\n    }\n    if (isV2) {\n      return queryV2(cozy, indexRef, options)\n    } else {\n      return queryV3(cozy, indexRef, options)\n    }\n  })\n}\n\n// Internals\n\nconst VALUEOPERATORS = ['$eq', '$gt', '$gte', '$lt', '$lte']\nconst LOGICOPERATORS = ['$or', '$and', '$not']\n\n/* eslint-disable */\nconst MAP_TEMPLATE = (function (doc) {\n  if (doc.docType.toLowerCase() === 'DOCTYPEPLACEHOLDER'){\n    emit(FIELDSPLACEHOLDER, doc)\n  }\n}).toString().replace(/ /g, '').replace(/\\n/g, '')\nconst COUCHDB_INFINITY = {\"\\uFFFF\": \"\\uFFFF\"}\nconst COUCHDB_LOWEST = null\n/* eslint-enable */\n\n// defineIndexV2 is equivalent to defineIndex but only works for V2.\n// It transforms the index fields into a map reduce view.\nfunction defineIndexV2 (cozy, doctype, fields) {\n  let indexName = 'by' + fields.map(capitalize).join('')\n  let indexDefinition = { map: makeMapFunction(doctype, fields), reduce: '_count' }\n  let path = `/request/${doctype}/${indexName}/`\n  return cozyFetchJSON(cozy, 'PUT', path, indexDefinition)\n    .then(() => ({ doctype: doctype, type: 'mapreduce', name: indexName, fields: fields }))\n}\n\n// defineIndexV2 is equivalent to defineIndex but only works for V2.\n// It transforms the index fields into a map reduce view.\nfunction defineIndexV3 (cozy, doctype, fields) {\n  let path = createPath(cozy, false, doctype, '_index')\n  let indexDefinition = {'index': {fields}}\n  return cozyFetchJSON(cozy, 'POST', path, indexDefinition)\n    .then((response) => ({ doctype: doctype, type: 'mango', name: response.id, fields: fields }))\n}\n\n// queryV2 is equivalent to query but only works for V2.\n// It transforms the query into a _views call using makeMapReduceQuery\nfunction queryV2 (cozy, indexRef, options) {\n  if (indexRef.type !== 'mapreduce') {\n    throw new Error('query indexRef should be the return value of defineIndexV2')\n  }\n  if (options.fields) {\n    warn('query fields will be ignored on v2')\n  }\n\n  let path = `/request/${indexRef.doctype}/${indexRef.name}/`\n  let opts = makeMapReduceQuery(indexRef, options)\n  return cozyFetchJSON(cozy, 'POST', path, opts)\n    .then((response) => response.map(r => r.value))\n}\n\n// queryV3 is equivalent to query but only works for V3\nfunction queryV3 (cozy, indexRef, options) {\n  if (indexRef.type !== 'mango') {\n    throw new Error('indexRef should be the return value of defineIndexV3')\n  }\n\n  let opts = {\n    use_index: indexRef.name,\n    fields: options.fields,\n    selector: options.selector,\n    limit: options.limit,\n    since: options.since\n  }\n\n  if (options.descending) {\n    opts.sort = indexRef.fields.map(f => ({ [f]: 'desc' }))\n  }\n\n  let path = createPath(cozy, false, indexRef.doctype, '_find')\n  return cozyFetchJSON(cozy, 'POST', path, opts)\n    .then((response) => response.docs)\n}\n\n// misc\nfunction capitalize (name) {\n  return name.charAt(0).toUpperCase() + name.slice(1)\n}\n\nfunction makeMapFunction (doctype, fields) {\n  fields = '[' + fields.map(name => 'doc.' + name).join(',') + ']'\n\n  return MAP_TEMPLATE.replace('DOCTYPEPLACEHOLDER', doctype.toLowerCase())\n                     .replace('FIELDSPLACEHOLDER', fields)\n}\n\n// parseSelector takes a mango selector and returns it as an array of filter\n// a filter is [path, operator, value] array\n// a path is an array of field names\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// [[['test', 'deep'], '$gt', 3 ]]\nexport function parseSelector (selector, path = [], operator = '$eq') {\n  if ((typeof selector) !== 'object') {\n    return [[path, operator, selector]]\n  }\n\n  let keys = Object.keys(selector)\n  if (keys.length === 0) {\n    throw new Error('empty selector')\n  } else {\n    return keys.reduce(function (acc, k) {\n      if (LOGICOPERATORS.indexOf(k) !== -1) {\n        throw new Error('cozy-client-js does not support mango logic ops')\n      } else if (VALUEOPERATORS.indexOf(k) !== -1) {\n        return acc.concat(parseSelector(selector[k], path, k))\n      } else {\n        return acc.concat(parseSelector(selector[k], path.concat(k), '$eq'))\n      }\n    }, [])\n  }\n}\n\n// normalizeSelector takes a mango selector and returns it as an object\n// normalized.\n// This function is only exported so it can be unit tested.\n// Example :\n// parseSelector({\"test\":{\"deep\": {\"$gt\": 3}}})\n// {\"test.deep\": {\"$gt\": 3}}\nexport function normalizeSelector (selector) {\n  var filters = parseSelector(selector)\n  return filters.reduce(function (acc, filter) {\n    let [path, op, value] = filter\n    let field = path.join('.')\n    acc[field] = acc[field] || {}\n    acc[field][op] = value\n    return acc\n  }, {})\n}\n\n// applySelector takes the normalized selector for the current field\n// and append the proper values to opts.startkey, opts.endkey\nfunction applySelector (selector, opts) {\n  let value = selector['$eq']\n  let lower = COUCHDB_LOWEST\n  let upper = COUCHDB_INFINITY\n  let inclusiveEnd\n\n  if (value) {\n    opts.startkey.push(value)\n    opts.endkey.push(value)\n    return false\n  }\n\n  value = selector['$gt']\n  if (value) {\n    throw new Error('operator $gt (strict greater than) not supported')\n  }\n\n  value = selector['$gte']\n  if (value) {\n    lower = value\n  }\n\n  value = selector['$lte']\n  if (value) {\n    upper = value\n    inclusiveEnd = true\n  }\n\n  value = selector['$lt']\n  if (value) {\n    upper = value\n    inclusiveEnd = false\n  }\n\n  opts.startkey.push(lower)\n  opts.endkey.push(upper)\n  if (inclusiveEnd !== undefined) opts.inclusive_end = inclusiveEnd\n  return true\n}\n\n// makeMapReduceQuery takes a mango query and generate _views call parameters\n// to obtain same results depending on fields in the passed indexRef.\nexport function makeMapReduceQuery (indexRef, query) {\n  let mrquery = {\n    startkey: [],\n    endkey: [],\n    reduce: false\n  }\n  let firstFreeValueField = null\n  let normalizedSelector = normalizeSelector(query.selector)\n\n  indexRef.fields.forEach(function (field) {\n    let selector = normalizedSelector[field]\n\n    if (selector && firstFreeValueField != null) {\n      throw new Error('Selector on field ' + field + ', but not on ' + firstFreeValueField + ' which is higher in index fields.')\n    } else if (selector) {\n      selector.used = true\n      let isFreeValue = applySelector(selector, mrquery)\n      if (isFreeValue) firstFreeValueField = field\n    } else if (firstFreeValueField == null) {\n      firstFreeValueField = field\n      mrquery.endkey.push(COUCHDB_INFINITY)\n    }\n  })\n\n  Object.keys(normalizedSelector).forEach(function (field) {\n    if (!normalizedSelector[field].used) {\n      throw new Error('Cant apply selector on ' + field + ', it is not in index')\n    }\n  })\n\n  if (query.descending) {\n    mrquery = {\n      descending: true,\n      reduce: false,\n      startkey: mrquery.endkey,\n      endkey: mrquery.startkey,\n      inclusive_end: mrquery.inclusive_end\n    }\n  }\n\n  return mrquery\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mango.js","/* global Blob, File */\nimport {cozyFetch, cozyFetchJSON} from './fetch'\nimport jsonapi from './jsonapi'\nimport { DOCTYPE_FILES } from './doctypes'\n\nconst contentTypeOctetStream = 'application/octet-stream'\n\nfunction doUpload (cozy, data, method, path, options) {\n  if (!data) {\n    throw new Error('missing data argument')\n  }\n\n  // transform any ArrayBufferView to ArrayBuffer\n  if (data.buffer && data.buffer instanceof ArrayBuffer) {\n    data = data.buffer\n  }\n\n  const isBuffer = (typeof ArrayBuffer !== 'undefined' && data instanceof ArrayBuffer)\n  const isFile = (typeof File !== 'undefined' && data instanceof File)\n  const isBlob = (typeof Blob !== 'undefined' && data instanceof Blob)\n  const isStream = (data.readable === true && typeof data.pipe === 'function')\n  const isString = (typeof data === 'string')\n\n  if (!isBuffer && !isFile && !isBlob && !isStream && !isString) {\n    throw new Error('invalid data type')\n  }\n\n  let {contentType, checksum, lastModifiedDate, ifMatch} = options || {}\n  if (!contentType) {\n    if (isBuffer) {\n      contentType = contentTypeOctetStream\n    } else if (isFile) {\n      contentType = data.type || contentTypeOctetStream\n      if (!lastModifiedDate) {\n        lastModifiedDate = data.lastModifiedDate\n      }\n    } else if (isBlob) {\n      contentType = contentTypeOctetStream\n    } else if (isStream) {\n      contentType = contentTypeOctetStream\n    } else if (typeof data === 'string') {\n      contentType = 'text/plain'\n    }\n  }\n\n  if (lastModifiedDate && typeof lastModifiedDate === 'string') {\n    lastModifiedDate = new Date(lastModifiedDate)\n  }\n\n  return cozyFetch(cozy, path, {\n    method: method,\n    headers: {\n      'Content-Type': contentType,\n      'Content-MD5': checksum || '',\n      'Date': lastModifiedDate ? lastModifiedDate.toGMTString() : '',\n      'If-Match': ifMatch || ''\n    },\n    body: data\n  })\n    .then((res) => {\n      const json = res.json()\n      if (!res.ok) {\n        return json.then(err => { throw err })\n      } else {\n        return json.then(jsonapi)\n      }\n    })\n}\n\nexport function create (cozy, data, options) {\n  let {name, dirID} = options || {}\n\n  // handle case where data is a file and contains the name\n  if (!name && typeof data.name === 'string') {\n    name = data.name\n  }\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(name)}&Type=file`\n  return doUpload(cozy, data, 'POST', `${path}${query}`, options)\n}\n\nexport function createDirectory (cozy, options) {\n  let {name, dirID, lastModifiedDate} = options || {}\n\n  if (typeof name !== 'string' || name === '') {\n    throw new Error('missing name argument')\n  }\n\n  if (lastModifiedDate && typeof lastModifiedDate === 'string') {\n    lastModifiedDate = new Date(lastModifiedDate)\n  }\n\n  const path = `/files/${encodeURIComponent(dirID || '')}`\n  const query = `?Name=${encodeURIComponent(name)}&Type=directory`\n  return cozyFetchJSON(cozy, 'POST', `${path}${query}`, undefined, {\n    headers: {\n      'Date': lastModifiedDate ? lastModifiedDate.toGMTString() : ''\n    }\n  })\n}\n\nexport function updateById (cozy, id, data, options) {\n  return doUpload(cozy, data, 'PUT', `/files/${encodeURIComponent(id)}`, options)\n}\n\nfunction doUpdateAttributes (cozy, attrs, path, options) {\n  if (!attrs || typeof attrs !== 'object') {\n    throw new Error('missing attrs argument')\n  }\n\n  const {ifMatch} = options || {}\n  const body = { data: { attributes: attrs } }\n  return cozyFetchJSON(cozy, 'PATCH', path, body, {\n    headers: {\n      'If-Match': ifMatch || ''\n    }\n  })\n}\n\nexport function updateAttributesById (cozy, id, attrs, options) {\n  return doUpdateAttributes(cozy, attrs,\n    `/files/${encodeURIComponent(id)}`, options)\n}\n\nexport function updateAttributesByPath (cozy, path, attrs, options) {\n  return doUpdateAttributes(cozy, attrs,\n    `/files/metadata?Path=${encodeURIComponent(path)}`, options)\n}\n\nexport function trashById (cozy, id) {\n  if (typeof id !== 'string' || id === '') {\n    throw new Error('missing id argument')\n  }\n  return cozyFetchJSON(cozy, 'DELETE', `/files/${encodeURIComponent(id)}`)\n}\n\nexport function statById (cozy, id, offline = true) {\n  if (offline && cozy.offline.hasDatabase(DOCTYPE_FILES)) {\n    let db = cozy.offline.getDatabase(DOCTYPE_FILES)\n    return Promise.all([\n      db.get(id),\n      db.find({selector: {'dir_id': id}})\n    ]).then(([doc, children]) => {\n      children = children.docs.map(doc => {\n        return addIsDir(toJsonApi(cozy, doc))\n      })\n      return addIsDir(toJsonApi(cozy, doc, children))\n    })\n  }\n  return cozyFetchJSON(cozy, 'GET', `/files/${encodeURIComponent(id)}`)\n    .then(addIsDir)\n}\n\nexport function statByPath (cozy, path) {\n  return cozyFetchJSON(cozy, 'GET', `/files/metadata?Path=${encodeURIComponent(path)}`)\n    .then(addIsDir)\n}\n\nexport function downloadById (cozy, id) {\n  return cozyFetch(cozy, `/files/download/${encodeURIComponent(id)}`)\n}\n\nexport function downloadByPath (cozy, path) {\n  return cozyFetch(cozy, `/files/download?Path=${encodeURIComponent(path)}`)\n}\n\nfunction extractResponseLinkRelated (res) {\n  let href = res.links && res.links.related\n  if (!href) throw new Error('No related link in server response')\n  return href\n}\n\nexport function getDowloadLink (cozy, path) {\n  return cozyFetchJSON(cozy, 'POST', `/files/downloads?Path=${encodeURIComponent(path)}`)\n    .then(extractResponseLinkRelated)\n}\n\nexport function getArchiveLink (cozy, paths, name = 'files') {\n  const archive = {\n    type: 'io.cozy.archives',\n    attributes: {\n      name: name,\n      files: paths\n    }\n  }\n  return cozyFetchJSON(cozy, 'POST', `/files/archive`, {data: archive})\n  .then(extractResponseLinkRelated)\n}\n\nexport function listTrash (cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/files/trash`)\n}\n\nexport function clearTrash (cozy) {\n  return cozyFetchJSON(cozy, 'DELETE', `/files/trash`)\n}\n\nexport function restoreById (cozy, id) {\n  return cozyFetchJSON(cozy, 'POST', `/files/trash/${encodeURIComponent(id)}`)\n}\n\nexport function destroyById (cozy, id) {\n  return cozyFetchJSON(cozy, 'DELETE', `/files/trash/${encodeURIComponent(id)}`)\n}\n\nfunction addIsDir (obj) {\n  obj.isDir = obj.attributes.type === 'directory'\n  return obj\n}\n\nfunction toJsonApi (cozy, doc, contents = []) {\n  let clone = JSON.parse(JSON.stringify(doc))\n  delete clone._id\n  delete clone._rev\n  return {\n    _id: doc._id,\n    _rev: doc._rev,\n    _type: DOCTYPE_FILES,\n    attributes: clone,\n    relations: (name) => {\n      if (name === 'contents') {\n        return contents\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/files.js","import PouchDB from 'pouchdb'\nimport pouchdbFind from 'pouchdb-find'\nimport { DOCTYPE_FILES } from './doctypes'\n\nlet pluginLoaded = false\n\nexport function init (cozy, { options = {}, doctypes = [], timer = false }) {\n  for (let doctype of doctypes) {\n    createDatabase(cozy, doctype, options)\n  }\n  if (timer) { startAllSync(cozy, timer) }\n}\n\nexport function createDatabase (cozy, doctype, options = {}, timer = false) {\n  if (!pluginLoaded) {\n    PouchDB.plugin(pouchdbFind)\n    pluginLoaded = true\n  }\n  cozy._offline = cozy._offline || []\n  cozy._offline[doctype] = cozy._offline[doctype] || {}\n  let offline = cozy._offline[doctype]\n  if (offline && offline.database) { return offline.database }\n  offline.database = new PouchDB(doctype, options)\n  offline.timer = timer\n  offline.autoSync = null\n  if (timer) { startSync(cozy, doctype, timer) }\n  createIndexes(cozy, offline.database, doctype)\n  return offline.database\n}\n\nexport function hasDatabase (cozy, doctype) {\n  return cozy._offline !== null &&\n    doctype in cozy._offline &&\n    cozy._offline[doctype].database !== undefined\n}\n\nexport function getDatabase (cozy, doctype) {\n  if (hasDatabase(cozy, doctype)) {\n    return cozy._offline[doctype].database\n  }\n  return\n}\n\nexport function destroyDatabase (cozy, doctype) {\n  if (hasDatabase(cozy, doctype)) {\n    stopSync(cozy, doctype)\n    getDatabase(cozy, doctype).destroy()\n    delete getDatabase(cozy, doctype)\n  }\n}\n\nexport function getDoctypes (cozy) {\n  if (cozy._offline === null) { return [] }\n  return Object.keys(cozy._offline)\n}\n\n//\n// SYNC\n//\n\nexport function startAllSync (cozy, timer) {\n  if (timer) {\n    const doctypes = getDoctypes(cozy)\n    doctypes.forEach((doctype) => {\n      startSync(cozy, doctype, timer)\n    })\n  }\n}\n\nexport function stopAllSync (cozy) {\n  const doctypes = getDoctypes(cozy)\n  doctypes.forEach((doctype) => {\n    stopSync(cozy, doctype)\n  })\n}\n\nexport function startSync (cozy, doctype, timer) {\n  // TODO: add timer limitation for not flooding Gozy\n  if (hasDatabase(cozy, doctype)) {\n    if (hasSync(cozy, doctype)) {\n      if (timer === cozy._offline[doctype].timer) { return }\n      stopSync(cozy, doctype)\n    }\n    let offline = cozy._offline[doctype]\n    offline.timer = timer\n    offline.autoSync = setInterval(() => {\n      if (offline.replicate === undefined) {\n        offline.replicate = replicateFromCozy(cozy, doctype)\n        offline.replicate.then((db) => {\n          db.on('complete', (info) => {\n            delete offline.replicate\n          })\n        })\n        // TODO: add replicationToCozy\n      }\n    }, timer * 1000)\n  }\n}\n\nexport function hasSync (cozy, doctype) {\n  return cozy._offline !== null &&\n    doctype in cozy._offline &&\n    cozy._offline[doctype].autoSync !== null\n}\n\nexport function stopSync (cozy, doctype) {\n  if (hasSync(cozy, doctype)) {\n    let offline = cozy._offline[doctype]\n    if (offline.replication) { offline.replication.cancel() }\n    clearInterval(offline.autoSync)\n    delete offline.autoSync\n  }\n}\n\nexport function replicateFromCozy (cozy, doctype, options = {}, events = {}) {\n  if (hasDatabase(cozy, doctype)) {\n    if (options.live === true) {\n      throw new Error('You can\\'t use `live` option with Cozy couchdb.')\n    }\n    if (options.manualAuthCredentials) {\n      return replicateFromCozyWithAuth(cozy, doctype, options, events, options.manualAuthCredentials)\n    } else {\n      return cozy.authorize().then((credentials) => {\n        return replicateFromCozyWithAuth(cozy, doctype, options, events, credentials)\n      })\n    }\n  } else {\n    throw new Error(`You should add this doctype: ${doctype} to offline.`)\n  }\n}\n\nexport function replicateFromCozyWithAuth (cozy, doctype, options, events, credentials) {\n  let basic = credentials.token.toBasicAuth()\n  let url = (cozy._url + '/data/' + doctype).replace('//', `//${basic}`)\n  let db = getDatabase(cozy, doctype)\n  let replication = db.replicate.from(url, options)\n  const eventNames = [\n    'change', 'paused', 'active', 'denied', 'complete', 'error'\n  ]\n  for (let eventName of eventNames) {\n    if (typeof events[eventName] === 'function') {\n      replication.on(eventName, events[eventName])\n    }\n  }\n  return replication\n}\n\nfunction createIndexes (cozy, db, doctype) {\n  if (doctype === DOCTYPE_FILES) {\n    db.createIndex({index: {fields: ['dir_id']}})\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/offline.js","module.exports = __WEBPACK_EXTERNAL_MODULE_15__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pouchdb\"\n// module id = 15\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_16__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pouchdb-find\"\n// module id = 16\n// module chunks = 0","import {cozyFetchJSON} from './fetch'\n\nexport function diskUsage (cozy) {\n  return cozyFetchJSON(cozy, 'GET', `/settings/disk-usage`)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/settings.js","import {cozyFetchJSON} from './fetch'\nimport { DOCTYPE_FILES } from './doctypes'\n\nexport function addReferencedFiles (cozy, doc, ids) {\n  if (!doc) throw new Error('missing doc argument')\n  if (!Array.isArray(ids)) ids = [ids]\n\n  const refs = ids.map((id) => ({type: DOCTYPE_FILES, id: id}))\n\n  return cozyFetchJSON(cozy, 'POST', makeReferencesPath(doc), {data: refs})\n}\n\nexport function listReferencedFiles (cozy, doc) {\n  if (!doc) throw new Error('missing doc argument')\n  return cozyFetchJSON(cozy, 'GET', makeReferencesPath(doc))\n    .then((files) => files.map((file) => file._id))\n}\n\nfunction makeReferencesPath (doc) {\n  const type = encodeURIComponent(doc._type)\n  const id = encodeURIComponent(doc._id)\n  return `/data/${type}/${id}/relationships/references`\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/relations.js","import {createPath} from './utils'\nimport {normalizeDoctype} from './doctypes'\nimport {cozyFetchJSON} from './fetch'\n\nconst NOREV = 'stack-v2-no-rev'\n\nexport function create (cozy, doctype, attributes) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    if (isV2) {\n      attributes.docType = doctype\n    }\n    const path = createPath(cozy, isV2, doctype)\n    return cozyFetchJSON(cozy, 'POST', path, attributes).then((resp) => {\n      if (isV2) {\n        return find(cozy, doctype, resp._id)\n      } else {\n        return resp.data\n      }\n    })\n  })\n}\n\nexport function find (cozy, doctype, id) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n\n    if (!id) {\n      return Promise.reject(new Error('Missing id parameter'))\n    }\n\n    const path = createPath(cozy, isV2, doctype, id)\n    return cozyFetchJSON(cozy, 'GET', path).then((resp) => {\n      if (isV2) {\n        return Object.assign(resp, {_rev: NOREV})\n      } else {\n        return resp\n      }\n    })\n  })\n}\n\nexport function changesFeed (cozy, doctype, options) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const path = createPath(cozy, isV2, doctype, '_changes', options)\n    return cozyFetchJSON(cozy, 'GET', path)\n  })\n}\n\nexport function update (cozy, doctype, doc, changes) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const {_id, _rev} = doc\n\n    if (!_id) {\n      return Promise.reject(new Error('Missing _id field in passed document'))\n    }\n\n    if (!isV2 && !_rev) {\n      return Promise.reject(new Error('Missing _rev field in passed document'))\n    }\n\n    if (isV2) {\n      changes = Object.assign({ _id }, changes)\n    } else {\n      changes = Object.assign({ _id, _rev }, changes)\n    }\n\n    const path = createPath(cozy, isV2, doctype, _id)\n    return cozyFetchJSON(cozy, 'PUT', path, changes).then((resp) => {\n      if (isV2) {\n        return find(cozy, doctype, _id)\n      } else {\n        return resp.data\n      }\n    })\n  })\n}\n\nexport function updateAttributes (cozy, doctype, _id, changes, tries = 3) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    return find(cozy, doctype, _id)\n      .then((doc) => {\n        return update(cozy, doctype, doc, Object.assign({ _id }, doc, changes))\n      })\n      .catch((err) => {\n        if (tries > 0) {\n          return updateAttributes(cozy, doctype, _id, changes, tries - 1)\n        } else {\n          throw err\n        }\n      })\n  })\n}\n\nexport function _delete (cozy, doctype, doc) {\n  return cozy.isV2().then((isV2) => {\n    doctype = normalizeDoctype(cozy, isV2, doctype)\n    const {_id, _rev} = doc\n\n    if (!_id) {\n      return Promise.reject(new Error('Missing _id field in passed document'))\n    }\n\n    if (!isV2 && !_rev) {\n      return Promise.reject(new Error('Missing _rev field in passed document'))\n    }\n\n    const query = isV2 ? null : { rev: _rev }\n    const path = createPath(cozy, isV2, doctype, _id, query)\n    return cozyFetchJSON(cozy, 'DELETE', path).then((resp) => {\n      if (isV2) {\n        return {id: _id, rev: NOREV}\n      } else {\n        return resp\n      }\n    })\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/data.js"],"sourceRoot":""}